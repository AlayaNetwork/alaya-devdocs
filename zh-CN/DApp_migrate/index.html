<!doctype html>
<html lang="zh-CN" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.3">
<link rel="search" type="application/opensearchdescription+xml" title="PlatON" href="/alaya-devdocs/zh-CN/opensearch.xml">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script src="https://cdn.jsdelivr.net/npm/mermaid@8.4.0/dist/mermaid.min.js"></script>
<script src="/alaya-devdocs/js/custom.js"></script><title data-react-helmet="true">DApp迁移 | PlatON</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://luo-dahui.github.io//alaya-devdocs/zh-CN/DApp_migrate"><meta data-react-helmet="true" name="docsearch:language" content="zh-CN"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="DApp迁移 | PlatON"><meta data-react-helmet="true" name="description" content="为了更好的支持开发者迁移以太坊DApp到Alaya，本文将从开发者角度，首先介绍Alaya与以太坊的差异，然后介绍迁移DApp的大体思路，最后针对DApp合约迁移和前端界面迁移进行具体的介绍。"><meta data-react-helmet="true" property="og:description" content="为了更好的支持开发者迁移以太坊DApp到Alaya，本文将从开发者角度，首先介绍Alaya与以太坊的差异，然后介绍迁移DApp的大体思路，最后针对DApp合约迁移和前端界面迁移进行具体的介绍。"><meta data-react-helmet="true" property="og:image" content="https://luo-dahui.github.io//alaya-devdocs/zh-CN/img/undraw_online.svg"><meta data-react-helmet="true" name="twitter:image" content="https://luo-dahui.github.io//alaya-devdocs/zh-CN/img/undraw_online.svg"><link data-react-helmet="true" rel="shortcut icon" href="/alaya-devdocs/zh-CN/img/logo.png"><link data-react-helmet="true" rel="canonical" href="https://luo-dahui.github.io//alaya-devdocs/zh-CN/DApp_migrate"><link data-react-helmet="true" rel="alternate" href="https://luo-dahui.github.io//alaya-devdocs/DApp_migrate" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://luo-dahui.github.io//alaya-devdocs/zh-CN/DApp_migrate" hreflang="zh-CN"><link data-react-helmet="true" rel="alternate" href="https://luo-dahui.github.io//alaya-devdocs/DApp_migrate" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/alaya-devdocs/zh-CN/assets/css/styles.ccba51f9.css">
<link rel="preload" href="/alaya-devdocs/zh-CN/assets/js/runtime~main.348013b4.js" as="script">
<link rel="preload" href="/alaya-devdocs/zh-CN/assets/js/main.3cc3a3f9.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">跳到主要内容</a></div><nav class="navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/alaya-devdocs/zh-CN/"><img src="/alaya-devdocs/zh-CN/img/alaya-logo.svg" alt="PlatON" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/alaya-devdocs/zh-CN/img/alaya-logo.svg" alt="PlatON" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a></div><div class="navbar__items navbar__items--right"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span></button><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__item navbar__link"><span>中文</span></a><ul class="dropdown__menu"><li><a href="/alaya-devdocs/en/DApp_migrate" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">English</a></li><li><a href="/alaya-devdocs/zh-CN/DApp_migrate" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">中文</a></li></ul></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/alaya-devdocs/zh-CN/"><img src="/alaya-devdocs/zh-CN/img/alaya-logo.svg" alt="PlatON" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/alaya-devdocs/zh-CN/img/alaya-logo.svg" alt="PlatON" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a href="#" role="button" class="menu__link menu__link--sublist"><span>Languages</span></a><ul class="menu__list"><li class="menu__list-item"><a href="/alaya-devdocs/en/DApp_migrate" target="_self" rel="noopener noreferrer" class="menu__link" style="text-transform:capitalize">English</a></li><li class="menu__list-item"><a href="/alaya-devdocs/zh-CN/DApp_migrate" target="_self" rel="noopener noreferrer" class="menu__link dropdown__link--active" style="text-transform:capitalize">中文</a></li></ul></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><main class="docMainContainer_3ufF docMainContainerEnhanced_3NYZ"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="markdown"><header><h1 class="h1Heading_27L5">DApp迁移</h1></header><p>为了更好的支持开发者迁移以太坊DApp到Alaya，本文将从开发者角度，首先介绍Alaya与以太坊的差异，然后介绍迁移DApp的大体思路，最后针对DApp合约迁移和前端界面迁移进行具体的介绍。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="alaya和以太坊的差异"></a>Alaya和以太坊的差异<a class="hash-link" href="#alaya和以太坊的差异" title="标题的直接链接">#</a></h2><p>对于Dapp开发者来说，无需关注底层技术上的差异。以下是针对开发者来说需要注意的差异点：</p><ul><li>Alaya和以太坊暴露的RPC方法基本都是一致的，区别在于rpc method名称的前缀不一样，Alaya网络的前缀是platon_</li><li>Alaya网络的地址类型是bech32 地址类型，以atp为前缀的字符串，区别于以太坊的0x前缀地址</li><li>Alaya的出块要比以太坊快，大约是1s出一个区块，所以block的timestamp是以毫秒为单位，以太坊的block的timestamp是以秒为单位</li><li>Alaya网络目前没有infrua类似的服务，目前对外的只有一个 <a href="https://openapi.alaya.network/rpc" target="_blank" rel="noopener noreferrer">https://openapi.alaya.network/rpc</a> 接口服务</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="dapp迁移思路"></a>DApp迁移思路<a class="hash-link" href="#dapp迁移思路" title="标题的直接链接">#</a></h2><p>要成功迁移DApp可以参考下面的迁移思路：</p><ol><li>先搞清楚DApp自身的主要功能，按功能依赖关系给功能做个依赖关系排序。以uniswap为例，功能依赖关系为：连上samurai 钱包-&gt;swap界面能够展示代币及显示余额-&gt;能够创建交易对并添加流动性-&gt;能够操作swap成功-&gt;能够移除流动性。</li><li>根据下文的“DApp合约迁移”章节迁移好DApp相关合约，部署到自己的Alaya测试网络。</li><li>根据第1步梳理功能依赖和下文的“DApp前端界面迁移”，依次调试通过每一个功能。</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="dapp合约迁移"></a>DApp合约迁移<a class="hash-link" href="#dapp合约迁移" title="标题的直接链接">#</a></h2><p>合约迁移修改点主要包含：</p><ol><li><p>Alaya支持的solidity是0.4.26、0.5.17、0.6.12、0.7.1 四个版本，如果迁移0.7.1以上版本的合约，需要降低版本号，去除高版本相关语法。例如，可以通过下面语句使用0.5.17的版本：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">pragma solidity </span><span class="token operator" style="color:rgb(137, 221, 255)">^</span><span class="token number" style="color:rgb(247, 140, 108)">0.5</span><span class="token number" style="color:rgb(247, 140, 108)">.17</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_Ue-o clean-btn">复制</button></div></div></li><li><p>Alaya智能合约中的货币单位为ATP和VON。要将以太坊智能合约迁移至Alaya，请将以太币面额更改为Alaya面额。同时注意以太/ATP市场汇率。</p></li><li><p>0x地址通过keytool工具转换成ATP地址，用atp地址替换0x地址，具体替换成什么地址需要根据业务逻辑决定。同时用address(uint160(0))代替address(0)。例如：</p><p>把下面语句：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token keyword control-flow" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function maybe-class-name" style="color:rgb(130, 170, 255)">IUniswapV2Factory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">factory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">getPair</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">tokenA</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> tokenB</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token spread operator" style="color:rgb(137, 221, 255)">...</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_Ue-o clean-btn">复制</button></div></div><p>修改为：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token keyword control-flow" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function maybe-class-name" style="color:rgb(130, 170, 255)">IUniswapV2Factory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">factory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">getPair</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">tokenA</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> tokenB</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">uint160</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token spread operator" style="color:rgb(137, 221, 255)">...</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_Ue-o clean-btn">复制</button></div></div></li><li><p>Alaya智能合约中block.timestamp表示的是当前区块以毫秒为单位的时间戳，以太坊是以秒为单位。block.timestamp需不需要修改需要根据业务逻辑来决定。在uniswap移植中合约的timestamp没有修改，但是前端把超时的时间由秒改成了毫秒。</p></li><li><p>合约开发指南请参考<a href="https://devdocs.alaya.network/alaya-devdocs/zh-CN/EVM_Smart_Contract/" target="_blank" rel="noopener noreferrer">EVM智能合约</a></p></li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="dapp前端界面迁移"></a>DApp前端界面迁移<a class="hash-link" href="#dapp前端界面迁移" title="标题的直接链接">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="修改连接钱包的方式"></a>修改连接钱包的方式<a class="hash-link" href="#修改连接钱包的方式" title="标题的直接链接">#</a></h3><p>Samurai为了跟metamask命名不冲突，把metamask的window.ethereum修改成了window.alaya，另外，<code>eth_</code>开头的接口改成了<code>platon_</code>，例如：eth_requestAccounts修改成了platon_requestAccounts。所以连接钱包的代码需要修改相对应的代码。Samurai开发者文档请参考：<a href="https://github.com/AlayaNetwork/Samurai/blob/main/docs/develop-manual.md" target="_blank" rel="noopener noreferrer">https://github.com/AlayaNetwork/Samurai/blob/main/docs/develop-manual.md</a> 。</p><p>在uniswap的迁移过程中，修改了项目 <a href="https://github.com/NoahZinsmeister/web3-react" target="_blank" rel="noopener noreferrer">https://github.com/NoahZinsmeister/web3-react</a> 的injected-connector包，具体修改请参考github提交 <a href="https://github.com/AlayaNetwork/aswap-web3-react/commits/alaya-v6.1.1" target="_blank" rel="noopener noreferrer">https://github.com/AlayaNetwork/aswap-web3-react/commits/alaya-v6.1.1</a> 。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="依赖包的修改"></a>依赖包的修改<a class="hash-link" href="#依赖包的修改" title="标题的直接链接">#</a></h3><ul><li><p>如果应用自身有连接以太坊节点，需要修改为连接Alaya节点，这样能够及时发现问题。</p></li><li><p>连上Samurai钱包后，根据业务的功能依赖，依次调试每一个功能，根据chrome调试的console控制台错误输出定位需要修改的依赖包。</p></li></ul><ul><li><p>很多Dapp的开发不可避免的会引用以太坊的第三方npm包，这些包中可能涉及地址相关或者rpc调用相关，这些被引用的包很大可能是没法支持顺利迁移的，在samurai和uniswap的Dapp的迁移过程中，我们已经修改并发布了一些npm包，可以考虑用支持Alaya网络的npm包进行替换，如果不存在的话可能需要考虑作适当修改后再发布。Alaya已经发布的依赖包可以参看<a href="https://github.com/AlayaNetwork" target="_blank" rel="noopener noreferrer">Alaya github</a>和<a href="https://www.npmjs.com/search?q=%40alayanetwork" target="_blank" rel="noopener noreferrer">Alaya npm仓库</a>。</p><p>已发布依赖包列表如下：</p><ol><li><a href="https://www.npmjs.com/package/@alayanetwork/eth-method-registry" target="_blank" rel="noopener noreferrer">@alayanetwork/eth-method-registry</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/ethjs-ens" target="_blank" rel="noopener noreferrer">@alayanetwork/ethjs-ens</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/eth-simple-keyring" target="_blank" rel="noopener noreferrer">@alayanetwork/eth-simple-keyring</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/eth-hd-keyring" target="_blank" rel="noopener noreferrer">@alayanetwork/eth-hd-keyring</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/ethjs-query" target="_blank" rel="noopener noreferrer">@alayanetwork/ethjs-query</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/eth-block-tracker" target="_blank" rel="noopener noreferrer">@alayanetwork/eth-block-tracker</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/ethjs-contract" target="_blank" rel="noopener noreferrer">@alayanetwork/ethjs-contract</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/ethjs" target="_blank" rel="noopener noreferrer">@alayanetwork/ethjs</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/ethjs-format" target="_blank" rel="noopener noreferrer">@alayanetwork/ethjs-format</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/eth-json-rpc-filters" target="_blank" rel="noopener noreferrer">@alayanetwork/eth-json-rpc-filters</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/nonce-tracker" target="_blank" rel="noopener noreferrer">@alayanetwork/nonce-tracker</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/web3-provider-engine" target="_blank" rel="noopener noreferrer">@alayanetwork/web3-provider-engine</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/ethjs-abi" target="_blank" rel="noopener noreferrer">@alayanetwork/ethjs-abi</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/web3-providers-http" target="_blank" rel="noopener noreferrer">@alayanetwork/web3-providers-http</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/web3-net" target="_blank" rel="noopener noreferrer">@alayanetwork/web3-net</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/web3-providers-ws" target="_blank" rel="noopener noreferrer">@alayanetwork/web3-providers-ws</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/web3-utils" target="_blank" rel="noopener noreferrer">@alayanetwork/web3-utils</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/web3-core-helpers" target="_blank" rel="noopener noreferrer">@alayanetwork/web3-core-helpers</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/ethereumjs-util" target="_blank" rel="noopener noreferrer">@alayanetwork/ethereumjs-util</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/web3-eth-contract" target="_blank" rel="noopener noreferrer">@alayanetwork/web3-eth-contract</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/eth-keyring-controller" target="_blank" rel="noopener noreferrer">@alayanetwork/eth-keyring-controller</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/web3-core-subscriptions" target="_blank" rel="noopener noreferrer">@alayanetwork/web3-core-subscriptions</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/web3-eth-abi" target="_blank" rel="noopener noreferrer">@alayanetwork/web3-eth-abi</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/web3-eth" target="_blank" rel="noopener noreferrer">@alayanetwork/web3-eth</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/ethereumjs-tx" target="_blank" rel="noopener noreferrer">@alayanetwork/ethereumjs-tx</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/web3-eth-iban" target="_blank" rel="noopener noreferrer">@alayanetwork/web3-eth-iban</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/web3-providers-ipc" target="_blank" rel="noopener noreferrer">@alayanetwork/web3-providers-ipc</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/web3-eth-accounts" target="_blank" rel="noopener noreferrer">@alayanetwork/web3-eth-accounts</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/web3-eth-personal" target="_blank" rel="noopener noreferrer">@alayanetwork/web3-eth-personal</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/web3-eth-ens" target="_blank" rel="noopener noreferrer">@alayanetwork/web3-eth-ens</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/eth-sig-util" target="_blank" rel="noopener noreferrer">@alayanetwork/eth-sig-util</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/ethjs-schema" target="_blank" rel="noopener noreferrer">@alayanetwork/ethjs-schema</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/rpc-cap" target="_blank" rel="noopener noreferrer">@alayanetwork/rpc-cap</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/eth-token-tracker" target="_blank" rel="noopener noreferrer">@alayanetwork/eth-token-tracker</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/etherscan-link" target="_blank" rel="noopener noreferrer">@alayanetwork/etherscan-link</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/uniswap-v2-periphery" target="_blank" rel="noopener noreferrer">@alayanetwork/uniswap-v2-periphery</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/eth-query" target="_blank" rel="noopener noreferrer">@alayanetwork/eth-query</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/controllers" target="_blank" rel="noopener noreferrer">@alayanetwork/controllers</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/inpage-provider" target="_blank" rel="noopener noreferrer">@alayanetwork/inpage-provider</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/forwarder" target="_blank" rel="noopener noreferrer">@alayanetwork/forwarder</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/eth-json-rpc-middleware" target="_blank" rel="noopener noreferrer">@alayanetwork/eth-json-rpc-middleware</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/uniswap-sdk" target="_blank" rel="noopener noreferrer">@alayanetwork/uniswap-sdk</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/ganache-core" target="_blank" rel="noopener noreferrer">@alayanetwork/ganache-core</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/web3-core-promievent" target="_blank" rel="noopener noreferrer">@alayanetwork/web3-core-promievent</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/web3-core-requestmanager" target="_blank" rel="noopener noreferrer">@alayanetwork/web3-core-requestmanager</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/web3-core-method" target="_blank" rel="noopener noreferrer">@alayanetwork/web3-core-method</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/web3-core" target="_blank" rel="noopener noreferrer">@alayanetwork/web3-core</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/web3" target="_blank" rel="noopener noreferrer">@alayanetwork/web3</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/web3-react-core" target="_blank" rel="noopener noreferrer">@alayanetwork/web3-react-core</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/web3-react-injected-connector" target="_blank" rel="noopener noreferrer">@alayanetwork/web3-react-injected-connector</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/ethers-solidity" target="_blank" rel="noopener noreferrer">@alayanetwork/ethers-solidity</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/ethers-contracts" target="_blank" rel="noopener noreferrer">@alayanetwork/ethers-contracts</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/ethers-bytes" target="_blank" rel="noopener noreferrer">@alayanetwork/ethers-bytes</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/ethers-abi" target="_blank" rel="noopener noreferrer">@alayanetwork/ethers-abi</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/ethers-providers" target="_blank" rel="noopener noreferrer">@alayanetwork/ethers-providers</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/ethers-address" target="_blank" rel="noopener noreferrer">@alayanetwork/ethers-address</a></li><li><a href="https://www.npmjs.com/package/@alayanetwork/token-lists" target="_blank" rel="noopener noreferrer">@alayanetwork/token-lists</a></li></ol></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="应用自身代码的修改"></a>应用自身代码的修改<a class="hash-link" href="#应用自身代码的修改" title="标题的直接链接">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="调用到alaya后端的rpc-method及参数"></a>调用到alaya后端的rpc method及参数<a class="hash-link" href="#调用到alaya后端的rpc-method及参数" title="标题的直接链接">#</a></h4><ul><li>alaya网络支持的rpc method是以platon_开头的(如: platon_sendTransaction)</li><li>个别rpc接口的参数类型等可能有不一致的，特别是地址类型需要注意。在开发的时候最好参考Alaya的<a href="https://devdocs.alaya.network/alaya-devdocs/zh-CN/Json_Rpc/" target="_blank" rel="noopener noreferrer">开发者文档</a></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="地址相关"></a>地址相关<a class="hash-link" href="#地址相关" title="标题的直接链接">#</a></h4><ul><li><p>调用rpc的时候参数如果是地址类型的话需要注意传入bech32地址类型。例如，如果程序中拿到了一个0x的合约地址，需要转换成bech32地址再调用，如下面代码所示：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token keyword control-flow" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">pair</span><span class="token operator" style="color:rgb(137, 221, 255)">?.</span><span class="token plain">liquidityToken</span><span class="token operator" style="color:rgb(137, 221, 255)">?.</span><span class="token plain">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> hrp </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> chainId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">toString</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">===</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;201018&#x27;</span><span class="token operator" style="color:rgb(137, 221, 255)">?</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;atp&#x27;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;atx&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    contractAddress </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">toBech32Address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">hrp</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">pair</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">liquidityToken</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_Ue-o clean-btn">复制</button></div></div></li><li><p>在涉及参数做编码(如encodeParam方法)的时候，可能需要考虑将bech32地址类型参数转换成0x类型再做编码，包括地址判断也需要修改。例如，uniswap合约参数编码的时候增加了下面逻辑：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token keyword control-flow" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">callInputs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    callInputs </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> callInputs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">map</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">callInput</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword control-flow" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">typeof</span><span class="token plain"> callInput </span><span class="token operator" style="color:rgb(137, 221, 255)">===</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;string&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">isBech32Address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">callInput</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">       </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword control-flow" style="font-style:italic">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">decodeBech32Address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">callInput</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="font-style:italic">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword control-flow" style="font-style:italic">return</span><span class="token plain"> callInput</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_Ue-o clean-btn">复制</button></div></div></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="alaya开发调试工具"></a>Alaya开发调试工具<a class="hash-link" href="#alaya开发调试工具" title="标题的直接链接">#</a></h2><p>请参考<a href="https://devdocs.alaya.network/alaya-devdocs/zh-CN/" target="_blank" rel="noopener noreferrer">Alaya开发者文档</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="metamask及uniswap迁移的经验总结"></a>Metamask及uniswap迁移的经验总结<a class="hash-link" href="#metamask及uniswap迁移的经验总结" title="标题的直接链接">#</a></h2><ul><li><p>Dapp一般都有一些功能集，我们可以按照这些功能级划分一个个milestone，比如针对metamask就是：</p><ul><li>成功导入助记词或创建钱包进入主界面</li><li>进入主界面，地址显示的是bech32地址并能成功获取并展示余额</li><li>能从一个账户成功发送原生的token到另一个账户</li><li>能搜索代币并添加成功，展示代币的余额</li><li>代币交易能发送成功</li></ul><p>在这一个个milestone过程中，出现的绝大部分问题可能就是以上提到的需要注意的问题，我们可以先直接修改依赖包的源码，能够让流程跑通，跑通后可以记录依赖包的修改点以利于后面依赖包的改动发布</p></li><li><p>正常来说Dapp的核心业务流程是基本不用改动的，但是我们依然还是要尝试去理解基本的业务流，这对于debug是有好处的</p></li><li><p>适当的在浏览器开发者模式下Network上观察是否有网络请求以及网络请求的结果</p></li><li><p>在某些情况下，真实的错误异常可能在某个地方被截获作处理了导致最终看到的错误并不是最初抛出的错误信息，这个时候需要进行debug找到处理前的最初的错误信息及堆栈</p></li><li><p>某些错误如果对alaya网络甚至底层知识掌握不多的话，可能也会很棘手，这种情况下建议可以在社区向有经验的开发者请教或讨论</p></li></ul></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/AlayaNetwork/alaya-devdocs/tree/main/website/i18n/zh-CN/docusaurus-plugin-content-docs/current/DApp_migrate.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_3DPF"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#alaya和以太坊的差异" class="table-of-contents__link">Alaya和以太坊的差异</a></li><li><a href="#dapp迁移思路" class="table-of-contents__link">DApp迁移思路</a></li><li><a href="#dapp合约迁移" class="table-of-contents__link">DApp合约迁移</a></li><li><a href="#dapp前端界面迁移" class="table-of-contents__link">DApp前端界面迁移</a><ul><li><a href="#修改连接钱包的方式" class="table-of-contents__link">修改连接钱包的方式</a></li><li><a href="#依赖包的修改" class="table-of-contents__link">依赖包的修改</a></li><li><a href="#应用自身代码的修改" class="table-of-contents__link">应用自身代码的修改</a></li></ul></li><li><a href="#alaya开发调试工具" class="table-of-contents__link">Alaya开发调试工具</a></li><li><a href="#metamask及uniswap迁移的经验总结" class="table-of-contents__link">Metamask及uniswap迁移的经验总结</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><ul class="footer__items"><li class="footer__item"><a href="https://www.alaya.network/" target="_blank" class="footer-logo-home" rel="noreferrer noopener"><img src="/alaya-devdocs/zh-CN/img/alaya-logo.svg" width="66" height="58"></a></li></ul></div><div class="col footer__col"><ul class="footer__items"><li class="footer__item"><a href="https://www.alaya.network/" target="_blank" rel="noopener noreferrer" class="footer__link-item" hrefzh="https://www.alaya.network/">Alaya network</a></li><li class="footer__item"><a href="https://latticex.foundation/home" target="_blank" rel="noopener noreferrer" class="footer__link-item" hrefzh="https://latticex.foundation/home">LatticeX.Foundation</a></li><li class="footer__item"><a href="https://forum.latticex.foundation/" target="_blank" rel="noopener noreferrer" class="footer__link-item" hrefzh="https://forum.latticex.foundation/">Forum</a></li></ul></div><div class="gitstar"><a class="github-button" href="https://github.com/PlatONnetwork/PlatON-Go" data-color-scheme="no-preference: light; light: light; dark: light;" data-icon="octicon-star" data-size="small" data-show-count="true" aria-label="Star PlatONnetwork/PlatON-Go on GitHub">Star</a></div></div><div class="footer__bottom text--center"><div class="footer__copyright">COPYRIGHT  © 2021 Alaya NETWORK.</div></div></div></footer></div>
<script src="/alaya-devdocs/zh-CN/assets/js/runtime~main.348013b4.js"></script>
<script src="/alaya-devdocs/zh-CN/assets/js/main.3cc3a3f9.js"></script>
</body>
</html>