(self.webpackChunkalaya_docs=self.webpackChunkalaya_docs||[]).push([[4302],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return p},kt:function(){return m}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=a.createContext({}),d=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},p=function(e){var t=d(e.components);return a.createElement(c.Provider,{value:t},e.children)},s={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,c=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),u=d(n),m=r,f=u["".concat(c,".").concat(m)]||u[m]||s[m]||o;return n?a.createElement(f,l(l({ref:t},p),{},{components:n})):a.createElement(f,l({ref:t},p))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,l=new Array(o);l[0]=u;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i.mdxType="string"==typeof e?e:r,l[1]=i;for(var d=2;d<o;d++)l[d]=n[d];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},1679:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return i},metadata:function(){return c},toc:function(){return d},default:function(){return s}});var a=n(2122),r=n(9756),o=(n(7294),n(3905)),l={id:"Solidity_Getting_started",title:"Getting started",sidebar_label:"Getting started"},i=void 0,c={unversionedId:"Solidity_Getting_started",id:"Solidity_Getting_started",isDocsHomePage:!1,title:"Getting started",description:"Introduction",source:"@site/docs/Solidity_Getting_started.md",sourceDirName:".",slug:"/Solidity_Getting_started",permalink:"/alaya-devdocs/en/Solidity_Getting_started",editUrl:"https://github.com/AlayaNetwork/alaya-devdocs/tree/main/website/docs/Solidity_Getting_started.md",version:"current",frontMatter:{id:"Solidity_Getting_started",title:"Getting started",sidebar_label:"Getting started"},sidebar:"docs",previous:{title:"IDE",permalink:"/alaya-devdocs/en/IDE"},next:{title:"Migration tutorial",permalink:"/alaya-devdocs/en/Solidity_Migration_tutorial"}},d=[{value:"Introduction",id:"introduction",children:[]},{value:"Alaya-truffle Introduction",id:"alaya-truffle-introduction",children:[]},{value:"Create HelloWorld Contract",id:"create-helloworld-contract",children:[]},{value:"Compile HelloWorld Contract",id:"compile-helloworld-contract",children:[]},{value:"Deploly HelloWorld Contract",id:"deploly-helloworld-contract",children:[]},{value:"Call HelloWorld Contract",id:"call-helloworld-contract",children:[]},{value:"Crowdfunding Contract",id:"crowdfunding-contract",children:[{value:"Introduction",id:"introduction-1",children:[]},{value:"Crowdfunding Process",id:"crowdfunding-process",children:[]},{value:"Crowdfunding Contract",id:"crowdfunding-contract-1",children:[]}]},{value:"FAQ",id:"faq",children:[{value:"About Compile",id:"about-compile",children:[]}]}],p={toc:d};function s(e){var t=e.components,n=(0,r.Z)(e,["components"]);return(0,o.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"introduction"},"Introduction"),(0,o.kt)("p",null,"This tutorial is mainly to guide users to create a simple HelloWorld smart contract using solidity language on Alaya, compile, deploy, and call this contract through alaya-truffle. If you want to experience a more versatile API, you can refer to  ",(0,o.kt)("a",{parentName:"p",href:"/alaya-devdocs/en/Java_SDK"},"Java SDK")," and  ",(0,o.kt)("a",{parentName:"p",href:"/alaya-devdocs/en/JS_SDK"},"JS SDK")," development guide."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"For the syntax of solidity smart contracts, please refer to ",(0,o.kt)("a",{parentName:"p",href:"https://solidity.readthedocs.io/en/develop/"},"Solidity Official Documentation"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Before developing the contract, if you need to build a node to connect to the Alaya network or create a private network, please refer to: ",(0,o.kt)("a",{parentName:"p",href:"/alaya-devdocs/en/Join_Alaya_NetWork"},"Connect to Alaya Network")))),(0,o.kt)("h2",{id:"alaya-truffle-introduction"},"Alaya-truffle Introduction"),(0,o.kt)("p",null,"Alaya-truffle is a tool provided by PlatON that can compile, deploy, and call smart contracts locally. For specific installation and usage manuals, refer to:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Alaya-truffle development tools ",(0,o.kt)("a",{parentName:"li",href:"https://platon-truffle.readthedocs.io/en/alaya/getting-started/installation.html"},"installation")),(0,o.kt)("li",{parentName:"ul"},"Alaya-truffle development tool ",(0,o.kt)("a",{parentName:"li",href:"https://platon-truffle.readthedocs.io/en/alaya/"},"usage manuals"))),(0,o.kt)("h2",{id:"create-helloworld-contract"},"Create HelloWorld Contract"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"pragma solidity ^0.5.17;\n\ncontract HelloWorld {\n    \n    string name;\n    \n    function setName(string memory _name) public returns(string memory){\n        name = _name;\n        return name;\n    }\n    \n    function getName() public view returns(string memory){\n        return name;\n    }\n}\n")),(0,o.kt)("p",null,"Contract Files Description:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"pragma solidity ^0.5.17",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"pragma solidity"),": Solidity version statement"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"0.5.17"),"\uff1aSolidity version"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"^")," \uff1aIndicates upward compatibility, that is, it can be compiled with a compiler above 0.5.17"))),(0,o.kt)("li",{parentName:"ul"},"contract HelloWorld",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"contract"),"\uff1aThe keyword of the contract statement"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"HelloWorld"),"\uff1aThe name of the current contract"))),(0,o.kt)("li",{parentName:"ul"},"string name",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"name"),"\uff1aState variable of the contract"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"string"),"\uff1aIt indicates the type of this state variable"))),(0,o.kt)("li",{parentName:"ul"},"function setName(string memory _name) public returns(string memory)",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"function"),"\uff1aThe name of this function"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"setName"),"\uff1aThe name of this function"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"memory"),"\uff1a It declares the storage location of the _name parameter (function input parameters and output parameters of string type must be declared as memory\uff09"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"\\_name")," \uff1aLocal variable of this function"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"public"),"\uff1aIt declares the visibility of this function"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"name")," = ","_","name\uff1a It assigns the local variable passed in from the outside to the state variable"))),(0,o.kt)("li",{parentName:"ul"},"function getName() public view returns(string memory)",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"view"),":  If a function has the view keyword, this function will not change the value of the state variable in the contract (mainly used for query)")))),(0,o.kt)("h2",{id:"compile-helloworld-contract"},"Compile HelloWorld Contract"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Step1."),"  Create a new directory for the HelloWorld project"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"mkdir HelloWorld && cd HelloWorld\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"The following commands are carried out in the HelloWorld directory if without special instructions.")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Step2."),"  Use alaya-truffle to initialize a project"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"alaya-truffle init\n")),(0,o.kt)("p",null,"After the command is executed, the structure of the project directory is as follows:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"Contracts/"),": Solidity contract directory")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"Migrations/"),":  Directory of the depolyment file")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"Test/"),": Directory of test scripts")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"Truffle-config.js"),": Alaya-truffle configuration files"))),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Step3."),"  Move the HelloWorld contract compiled under ",(0,o.kt)("inlineCode",{parentName:"p"},"HelloWorld/contracts/")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"ls contracts/\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"You will see ",(0,o.kt)("inlineCode",{parentName:"p"},"HelloWorld.sol"),".")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Step4."),"  Modify the aaya-truffle configuration file ",(0,o.kt)("inlineCode",{parentName:"p"},"truffle-config.js"),", and modify the compiler version to the version number in the corresponding solidity contract"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"vim truffle-config.js\n")),(0,o.kt)("p",null,"The modified contents of ",(0,o.kt)("inlineCode",{parentName:"p"},"truffle-config.js")," are as follows:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'compilers: {\n      solc: {\n            version: "^0.5.17",    // This version number is consistent with the version number declared in HelloWorld.sol\n      }\n}\n')),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Step5."),"  Compile contract"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"alaya-truffle compile\n")),(0,o.kt)("p",null,"After the command is executed, the structure of the project directory is as follows:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"Build/"),": The directory where the Solidity contract is compiled")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"Build/contracts/HelloWorld.json"),": The compiled file corresponding to ",(0,o.kt)("inlineCode",{parentName:"p"},"HelloWorld.sol")))),(0,o.kt)("h2",{id:"deploly-helloworld-contract"},"Deploly HelloWorld Contract"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Step1.")," Add the contract deployment script file:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"cd migrations/ && touch 2_initial_helloworld.js\n")),(0,o.kt)("p",null,"It is recommended to name the deployment script file with the contract name for the sake of subsequent maintenance. For example, the deployment script file corresponding to the HelloWorld contract is ",(0,o.kt)("inlineCode",{parentName:"p"},"2_initial_helloworld.js"),", and the content is as follows:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'const helloWorld = artifacts.require("HelloWorld"); //artifacts.require tells aaya-truffle which contract needs to be deployed. \n    module.exports = function(deployer) {\n       deployer.deploy(helloWorld); //Failed to deploy contract with parameters, please refer to FAQ\n};\n')),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Step2.")," Modify the configuration information of ",(0,o.kt)("inlineCode",{parentName:"p"},"truffle-config.js")," in the chain"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"vim truffle-config.js\n")),(0,o.kt)("p",null,"Modify the blockchain-related configuration in ",(0,o.kt)("inlineCode",{parentName:"p"},"truffle-config.js")," to the chain configuration of your real connection:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'networks: {\n    development: {\n       host: "10.1.1.6",     // Blockchain server host\n       port: 8806,            // Chain port number\n       network_id: "*",       // Any network (default: none)\n       from: "atp1jtfqqqr6436ppj6ccnrh8xjg7qals3ctnnmurp", //The wallet address of the deployment contract account\n       gas: 999999,\n       gasPrice: 50000000004,\n    },\n}\n')),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"step3."),"  Unlock wallet account"),(0,o.kt)("p",null,"Enter the alaya-truffle console:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"alaya-truffle console\n")),(0,o.kt)("p",null,"Import the private key (you can skip this step if you have already imported it):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'web3.platon.personal.importRawKey("Your wallet private key","Your wallet password");\n')),(0,o.kt)("p",null,"You will see the address corresponding to the private key after importing it:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"'atp1jtfqqqr6436ppj6ccnrh8xjg7qals3ctnnmurp'\n")),(0,o.kt)("p",null,"Unlock wallet account"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"}," web3.platon.personal.unlockAccount('Your wallet address','Your wallet password',999999);\n")),(0,o.kt)("p",null,"After unlocking it successfully, you will see the following information\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"ture\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Step4."),"  Deploy contract"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"alaya-truffle migrate\n")),(0,o.kt)("p",null,"After successful deployment\uff0cyou will see log info as follows:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"2_initial_helloworld.js\n======================\n\n   Deploying 'HelloWorld'\n   ----------------------\n   > transaction hash:    0x87cd48cc467f9bc943fd096c57c8a7e7b7fa941380538d9e59797800c6c4292c\n   > Blocks: 0            Seconds: 0\n   > contract address:    atp1c5xxup4au4pqkgkm6a3p6hj3x0vvekdj52z2la\n   > block number:        282520\n   > block timestamp:     1585535169200\n   > account:             atp1jtfqqqr6436ppj6ccnrh8xjg7qals3ctnnmurp\n   > balance:             16447231233352977496646259638377769924557918764752765436645.336513079692286014\n   > gas used:            145569\n   > gas price:           1 gvon\n   > value sent:          0 ATP\n   > total cost:          0.000145569 ATP\n\n\n   > Saving migration to chain.\n   > Saving artifacts\n   -------------------------------------\n   > Total cost:          0.000145569 ATP\n\nSummary\n=======\n> Total deployments:   2\n> Final cost:          0.000259892 ATP\n")),(0,o.kt)("h2",{id:"call-helloworld-contract"},"Call HelloWorld Contract"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Step1."),"  Enter the alaya-truffle console"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"alaya-truffle console\n")),(0,o.kt)("p",null,"You can execute the command in alaya-truffle console"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Step2."),"  Create contract object"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'var abi = [{"constant":false,"inputs":[{"internalType":"string","name":"_name","type":"string"}],"name":"setName","outputs":[{"internalType":"string","name":"","type":"string"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"getName","outputs":[{"internalType":"string","name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"}]; //you can refet to HelloWorld/build/contracts/HelloWorld.json\n\nvar contractAddr = \'atp1c5xxup4au4pqkgkm6a3p6hj3x0vvekdj52z2la\';//contract address\nvar helloWorld = new web3.platon.Contract(abi,contractAddr);  \n')),(0,o.kt)("p",null,"Description\uff1a"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"abi")," is the interface provided by the contract for external calls. The abi corresponding to each contract can be found in the compiled file, such as: ",(0,o.kt)("inlineCode",{parentName:"li"},"HelloWorld/build/contracts/HelloWorld.json")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"contractAddr"),"  has a contract address after deploying the contract successfully"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"helloWorld")," is the abstraction of contract objects constructed to interact with on-chain contracts")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Step3."),"  Call contract"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"helloWorld.methods.setName(\"hello world\").send({from: 'atp1jtfqqqr6436ppj6ccnrh8xjg7qals3ctnnmurp'}).on('receipt', function(receipt) {console.log(receipt);}).on('error', console.error);\n")),(0,o.kt)("p",null,"Description\uff1a"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"helloWorld"),"  is the contract object built before"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"methods"),"  is the fixed syntax, followed by the method name of the contract"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"setName")," is a method in the HelloWorld contract. It has an input parameter of type String, where the input parameter is ",(0,o.kt)("inlineCode",{parentName:"li"},"hello world")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"from"),"  is the wallet address of the caller"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"on")," is to monitor the event of the contract processing result. If it succeeds, a receipt will be printed, or an error log will be output if it fails:")),(0,o.kt)("p",null,"After the function call is successful, you will see the log info as below:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"{ \n  blockHash:'0x3ae287d1e745e30d0d6c95d5220cc7816cda955e7b2f013c6a531ed95028a794', //the hash of block the transaction located\n  blockNumber: 159726, \n  contractAddress: null,\n  cumulativeGasUsed: 44820,\n  from: 'atp1jtfqqqr6436ppj6ccnrh8xjg7qals3ctnnmurp', //the address of caller\n  gasUsed: 44820, //gas cost\n  logsBloom:\n   '0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',\n  status: true,\n  to: 'atp1c5xxup4au4pqkgkm6a3p6hj3x0vvekdj52z2la', //contract address\n  transactionHash:'0xb7a41f72d555d4a2d9f2954fbdc5bbbb4c5ce89c836f8704276419ed416b3866', \n  transactionIndex: 0,\n  events: {} \n}\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Step4."),"  Query contract"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'helloWorld.methods.getName().call(null,function(error,result){console.log("name is:" + result);})  \n')),(0,o.kt)("p",null,"Description\uff1a"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"helloWorld")," is the contract object built before"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"methods")," specifies that the methods in the contract will be obtained"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"getName")," is a method in the HelloWorld contract. This method has no input parameters, so the input parameters are empty"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"call"),"  indicates the query method"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"function"),"  is a callback function that will process the result of the call. Here we print the execution result through ",(0,o.kt)("inlineCode",{parentName:"li"},"console.log"))),(0,o.kt)("hr",null),(0,o.kt)("h2",{id:"crowdfunding-contract"},"Crowdfunding Contract"),(0,o.kt)("h3",{id:"introduction-1"},"Introduction"),(0,o.kt)("p",null,"In the following example, we will use the contract for a crowdfunding. The contract creator initiates crowdfunding and initializes the number of tokens for crowdfunding and the duration of crowdfunding. If completed within the specified time, the crowdfunding is successful, and the crowdfunding access will be closed. As a result, a certain number of tokens obtained according to a fixed exchange rate will be minted and credited in the buyer's name. Otherwise, the crowdfunding fails, and the crowdfunding amount is returned to investors."),(0,o.kt)("p",null,"Two roles are set in the contract"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Crowdfunders"),(0,o.kt)("li",{parentName:"ul"},"Investors")),(0,o.kt)("h3",{id:"crowdfunding-process"},"Crowdfunding Process"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Create a crowdfunding contract, and designate the beneficiary"),(0,o.kt)("li",{parentName:"ul"},"Deploy the contract to initialize the number and duration of crowdfunding tokens"),(0,o.kt)("li",{parentName:"ul"},"Investors make investments"),(0,o.kt)("li",{parentName:"ul"},"Determine whether the crowdfunding is over:",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"If the crowdfunding has reached the target amount before the deadline, the access is closed, and tokens are allocated proportionally to investors. The crowdfunding succeeds."),(0,o.kt)("li",{parentName:"ul"},"If the crowdfunding has reached the target amount upon the deadline, tokens are allocated proportionally to investors. The crowdfunding succeeds."),(0,o.kt)("li",{parentName:"ul"},"If the crowdfunding has not reached the target amount upon the deadline, tokens are returned to investors. The crowdfunding fails.")))),(0,o.kt)("h3",{id:"crowdfunding-contract-1"},"Crowdfunding Contract"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"pragma solidity ^0.5.17;\n\ncontract CrowdFunding {\n    address payable public beneficiaryAddress = address(uint160(0)); //Beneficiary address, set as contract creator\n    uint256 public fundingGoal = 100 atp;  //Crowdfunding target, with the unit as ATP\n    uint256 public amountRaised = 0; //The amount of money raised, the unit is VON\n    uint256 public deadline; //Deadline\n    uint256 public price;  //token price\n    bool public fundingGoalReached = false;  //The crowdfunding target is reached\n    bool public crowdsaleClosed = false; //Crowdfunding is closed\n\n    mapping(address => uint256) public balance; //Save the amount donated by crowdfunders\n    \n    mapping(address => uint256) public tokenMap; //Save the number of tokens owned by the crowdfunder\n\n    //Record received ATP notifications\n    event GoalReached(address _beneficiaryAddress, uint _amountRaised);\n\n    //Transfer notification\n    event FundTransfer(address _backer, uint _amount, bool _isContribution);\n    \n    //Check whether the address is empty\n    modifier validAddress(address _address) {\n        require(_address != address(uint160(0)));\n        _;\n    }\n\n    /**\n     * Initialization constructor\n     *\n     * @param _fundingGoalInlats: Total crowdfunding amount of ATP\n     * @param _durationInMinutes: Crowdfunding deadline, with the unit as minute\n     */\n    constructor (\n        uint _fundingGoalInlats,\n        uint _durationInMinutes\n    )public {\n        beneficiaryAddress = msg.sender;\n        fundingGoal = _fundingGoalInlats * 1 atp;\n        deadline = now + _durationInMinutes * 1 minutes;\n        price = 500 finney; //You can buy 2 tokens with 1 ATP\n    }\n\n\n    /**\n     * fallback functioin\n     *\n     * you can send money directly to the contract\n     */\n    function () payable external {\n\n        //check whether to close crowdfunding\n        require(!crowdsaleClosed);\n        uint amount = msg.value;\n\n        //investor amount accumulated\n        balance[msg.sender] += amount;\n\n        //Total invest accumulated\n        amountRaised += amount;\n\n        //Transfer operation, how many tokens are transferred to the investor\n        tokenMap[msg.sender]  += amount / price;\n        \n        emit FundTransfer(msg.sender, amount, true);\n    }\n\n    /**\n     * Determine if the crowdfunding deadline has passed\n     */\n    modifier afterDeadline() { if (now >= deadline) _; }\n\n    /**\n     * Check if the crowdfunding goal has been reached\n     */\n    function checkGoalReached() public afterDeadline payable{\n        if (amountRaised >= fundingGoal){\n            //crowdfunding goal has been reached\n            fundingGoalReached = true;\n            emit GoalReached(beneficiaryAddress, amountRaised);\n        }\n\n        //Closing crowdfunding\n        crowdsaleClosed = true;\n    }\n\n\n    /**\n     * Recover funds\n     *\n     * Check if the target or time limit has been reached, and if so, send the full amount to the beneficiary.\n     * If the goal is not reached, each investor can return the amount they invested\n     */\n    function safeWithdrawal() public afterDeadline {\n\n        //If the crowdfunding goal is not reached\n        if (!fundingGoalReached) {\n            //Get the contracted caller's donated balance\n            uint amount = balance[msg.sender];\n\n            if (amount > 0) {\n                //Returns all balances of the contract initiator\n                msg.sender.transfer(amount);\n                emit FundTransfer(msg.sender, amount, false);\n                balance[msg.sender] = 0;\n            }\n        }\n\n        //f the crowdfunding goal is achieved and the contract caller is the beneficiary\n        if (fundingGoalReached && beneficiaryAddress == msg.sender) {\n\n            //Give all donations from the contract to the beneficiary\n            beneficiaryAddress.transfer(amountRaised);\n            \n            emit FundTransfer(beneficiaryAddress, amountRaised, false);\n        }\n    }\n}\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Compile Crowdfunding Contract")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Step1.")," Create a new directory for a crowdfunding project"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"mkdir myCrowdFunding && cd myCrowdFunding\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"The following commands are performed in the myCrowdFunding directory if without special instructions")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Step2.")," Initialize a project using alaya-truffle "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"alaya-truffle init\n")),(0,o.kt)("p",null,"After the command is executed, the structure of the project directory is as follows:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"contracts/"),": Solidity contract directory"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"migrations/"),": Directory of the depolyment file"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"test/"),": Directory of test scripts"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"truffle-config.js"),": Alaya-truffle configuration file")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Step3.")," Move the crowdfunding contract compiled under ",(0,o.kt)("inlineCode",{parentName:"p"},"myCrowdFunding/contracts/")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"ls myCrowdFunding/contracts/\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Files in the directory: ",(0,o.kt)("inlineCode",{parentName:"p"},"crowdFunding.sol"),".")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Step4."),"  Modify the alaya-truffle configuration file ",(0,o.kt)("inlineCode",{parentName:"p"},"truffle-config.js")," and add the compiled solidity contract version number"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"vim truffle-config.js\n")),(0,o.kt)("p",null,"The modified contents of ",(0,o.kt)("inlineCode",{parentName:"p"},"truffle-config.js")," are as follows:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'compilers: {\n     solc: {\n        version: "0.5.17",    //This version number is consistent with the version number declared in CrowdFunding.sol\n    }\n}\n')),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Step5.")," Compile contract"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"alaya-truffle compile\n")),(0,o.kt)("p",null,"After the command is executed, the structure of the project directory is as follows:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"build/"),": The directory of the Solidity contract compiled"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"build/contracts/CrowdFunding.json"),": Compiled file corresponding to ",(0,o.kt)("inlineCode",{parentName:"li"},"CrowdFunding.sol"))),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Deploly crowdfunding Contract")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Step1.")," Create deploy script"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"cd migrations/ && touch 2_initial_CrowdFunding.js\n")),(0,o.kt)("p",null,"Deploy script 2_initial_crowdFunding.js, content is as follows\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'const CrowdFunding = artifacts.require("CrowdFunding"); //deployment contract class name\nmodule.exports = function(deployer) {\n      deployer.deploy(CrowdFunding,1000000,100);\n};\n')),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Step2."),"  Modify the configuration information of ",(0,o.kt)("inlineCode",{parentName:"p"},"truffle-config.js")," in the chain"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"vim truffle-config.js\n")),(0,o.kt)("p",null,"Modify the blockchain-related configuration in ",(0,o.kt)("inlineCode",{parentName:"p"},"truffle-config.js")," to the chain configuration of your real connection"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'networks: {\n    development: {\n       host: "10.1.1.6",     // Blockchain server host\n       port: 8806,            // Chain port number\n       network_id: "*",       // Any network (default: none)\n       from: "atp1jtfqqqr6436ppj6ccnrh8xjg7qals3ctnnmurp", //Wallet address of the deployment contract account\n       gas: 999999,\n       gasPrice: 50000000004,\n    },\n}\n')),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Step3.")," Deploy contract"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"alaya-truffle migrate\n")),(0,o.kt)("p",null,"After successful deployment\uff0cyou will see log info as follows:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"Compiling your contracts...\n Everything is up to date, there is nothing to compile.\n 3_initial_CrowdFunding.js\n \n    Deploying 'CrowdFunding'\n     transaction hash:    0x3a6419cd4169d7cfb430a1fc5632239ac4a01845827f20df9b3229a334c5488b\n     Blocks: 0            Seconds: 0\n     contract address:    atp1crcjuu9uwa9aukmf5dr5tq4ym6cv2kre0042ya //contract address\n     block number:        280532\n     block timestamp:     1581751224032\n     account:             atp1jtfqqqr6436ppj6ccnrh8xjg7qals3ctnnmurp\n     balance:             90000000.806077629992489796\n     gas used:            379154\n     gas price:           50.000000004 gVON\n     value sent:          0 ATP\n     total cost:          0.018957700001516616 ATP\n \n     Saving migration to chain.\n     Saving artifacts\n     Total cost:     0.018957700001516616 ATP\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Query the crowdfunding progress"),"\uff1a**"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Step1."),"  Enter the alaya-truffle console"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"alaya-truffle console\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"You can execute the command in alaya-truffle console")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Step2."),"  Create a crowdfunding contract object"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"var abi = [...]; //The ABI of the crowdfunding contract, accessed from the compiled file\nvar contractAddr = 'atp1crcjuu9uwa9aukmf5dr5tq4ym6cv2kre0042ya'; //CrowdFundsing contract address\nvar crowdFunding = new web3.platon.Contract(abi,contractAddr);\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Step3."),"  Query the amount raised"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'crowdFunding.methods.amountRaised().call(null,function(error,result){console.log("result:" + result);}); //query the amount raised\n')),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Step4."),"  Crowdfunder judges whether the crowdfunding is successful"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"crowdFunding.methods.safeWithdrawal().send({from:'atp1jtfqqqr6436ppj6ccnrh8xjg7qals3ctnnmurp'}).on('data', function(event){ console.log(event);}).on('error', console.error); \n")),(0,o.kt)("p",null,"Call contract command description:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"crowdFunding"),"  is the contract object we built before"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"methods")," is the fixed syntax, specifying the methods in the contract that will be accessed"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"safeWithdrawal")," is a method in our crowdfunding contract to recover funds"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"from")," is the wallet address of the caller"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"on")," is to monitor the event of the contract processing result. If it succeeds, a receipt will be printed, or an error log will be output if it fails")),(0,o.kt)("hr",null),(0,o.kt)("h2",{id:"faq"},"FAQ"),(0,o.kt)("h3",{id:"about-compile"},"About Compile"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"What are the commands of alaya-truffle and how to use them?"),(0,o.kt)("p",{parentName:"li"},"For Alaya-truffle Development Manual, ",(0,o.kt)("a",{parentName:"p",href:"https://platon-truffle.readthedocs.io/en/alaya/"},"refer here"),".")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Why does the contract fail to pass the syntax verification?"),(0,o.kt)("p",{parentName:"li"},"There are major changes between solidity contract 0.4.x version and 0.5.x version. For the specific syntax, ",(0,o.kt)("a",{parentName:"p",href:"https://solidity.readthedocs.io/en/develop/"},"refer here"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"What if Alaya-truffle failed to execute truffle compile?"),(0,o.kt)("p",{parentName:"li"},"Confirm whether the version number in the compiled contract file is consistent with the version number specified in ",(0,o.kt)("inlineCode",{parentName:"p"},"truffle-config.js"),".\nThe syntax may be wrong. You can fix it according to the command line prompts before compiling.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"What if Alaya-truffle failed to execute truffle migrate deployment contract?"),(0,o.kt)("p",{parentName:"li"},"Confirm whether the configuration information of the connected chain in ",(0,o.kt)("inlineCode",{parentName:"p"},"truffle-config.js")," and the user's wallet address are correct.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"What if truffle failed to deploy a constructor contract with parameters?"),(0,o.kt)("p",{parentName:"li"},"Take the contract A.sol as an example. In the ",(0,o.kt)("inlineCode",{parentName:"p"},"migrations/2_initial_A.js file"),", confirm whether to add the construction parameter information. For example: The A.sol constructor format is as follows:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"Constructor(uint256 a, string memory b, string memory c) public {}\n")),(0,o.kt)("p",{parentName:"li"},"The ",(0,o.kt)("inlineCode",{parentName:"p"},"2_initial_A.js")," file configuration is as follows:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"const A = artifacts.require(\"A\");  \nmodule.exports = function(deployer) {\n        deployer.deploy(A,100,'PLA','PLAT');//pass the corresponding construction parameters\n};\n")))))}s.isMDXComponent=!0}}]);