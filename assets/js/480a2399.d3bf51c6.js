(self.webpackChunkalaya_docs=self.webpackChunkalaya_docs||[]).push([[2610],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return c},kt:function(){return u}});var a=n(7294);function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){f(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,f=function(e,t){if(null==e)return{};var n,a,f={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(f[n]=e[n]);return f}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(f[n]=e[n])}return f}var l=a.createContext({}),s=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=s(e.components);return a.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},p=a.forwardRef((function(e,t){var n=e.components,f=e.mdxType,r=e.originalType,l=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),p=s(n),u=f,m=p["".concat(l,".").concat(u)]||p[u]||d[u]||r;return n?a.createElement(m,o(o({ref:t},c),{},{components:n})):a.createElement(m,o({ref:t},c))}));function u(e,t){var n=arguments,f=t&&t.mdxType;if("string"==typeof e||f){var r=n.length,o=new Array(r);o[0]=p;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:f,o[1]=i;for(var s=2;s<r;s++)o[s]=n[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},430:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return o},contentTitle:function(){return i},metadata:function(){return l},toc:function(){return s},default:function(){return d}});var a=n(2122),f=n(9756),r=(n(7294),n(3905)),o={id:"EVM_Smart_Contract",title:"EVM Smart Contract",sidebar_label:"EVM Smart Contract"},i=void 0,l={unversionedId:"EVM_Smart_Contract",id:"EVM_Smart_Contract",isDocsHomePage:!1,title:"EVM Smart Contract",description:"This guide introduces the development process of smart contracts and issues should be noticed during development process from the perspective of the developer. It guides developers to quickly develop high-quality smart contracts on the Alaya network. Mainly from the following aspects to explain\uff1a",source:"@site/docs/EVM_Smart_Contract.md",sourceDirName:".",slug:"/EVM_Smart_Contract",permalink:"/alaya-devdocs/EVM_Smart_Contract",editUrl:"https://github.com/AlayaNetwork/alaya-devdocs/tree/main/website/docs/EVM_Smart_Contract.md",version:"current",frontMatter:{id:"EVM_Smart_Contract",title:"EVM Smart Contract",sidebar_label:"EVM Smart Contract"}},s=[{value:"Development Manual",id:"development-manual",children:[{value:"Introduction",id:"introduction",children:[]},{value:"alaya-truffle Introduction",id:"alaya-truffle-introduction",children:[]},{value:"Create HelloWorld Contract",id:"create-helloworld-contract",children:[]},{value:"Compile HelloWorld Contract",id:"compile-helloworld-contract",children:[]},{value:"Deploly HelloWorld Contract",id:"deploly-helloworld-contract",children:[]},{value:"Call HelloWorld Contract",id:"call-helloworld-contract",children:[]}]},{value:"Migrate Contract",id:"migrate-contract",children:[{value:"Introduction",id:"introduction-1",children:[]},{value:"Operation Procedure",id:"operation-procedure",children:[]}]},{value:"Crowdfunding Contract",id:"crowdfunding-contract",children:[{value:"Introduction",id:"introduction-2",children:[]},{value:"Crowdfunding Process",id:"crowdfunding-process",children:[]},{value:"Crowdfunding Contract",id:"crowdfunding-contract-1",children:[]}]},{value:"Development Costs",id:"development-costs",children:[{value:"Introduction",id:"introduction-3",children:[]},{value:"Summary",id:"summary",children:[]},{value:"Small-sized Contract",id:"small-sized-contract",children:[]},{value:"Medium-sized Contract",id:"medium-sized-contract",children:[]},{value:"Large-sized Contract",id:"large-sized-contract",children:[]}]},{value:"Best Practice",id:"best-practice",children:[{value:"Introduction",id:"introduction-4",children:[]},{value:"Reasonable Cost Setting",id:"reasonable-cost-setting",children:[]},{value:"Avoid Timeouts",id:"avoid-timeouts",children:[]},{value:"Punishment For Illegal Operations",id:"punishment-for-illegal-operations",children:[]},{value:"Coding Standards",id:"coding-standards",children:[]}]},{value:"Contract Security Development Guide",id:"contract-security-development-guide",children:[{value:"Compiler Bug",id:"compiler-bug",children:[]},{value:"Standard Contract Development Process",id:"standard-contract-development-process",children:[]},{value:"Common Pitfalls",id:"common-pitfalls",children:[]},{value:"Security Recommendations",id:"security-recommendations",children:[]},{value:"Security Tools",id:"security-tools",children:[]},{value:"Third Party Audit",id:"third-party-audit",children:[]}]},{value:"FAQ",id:"faq",children:[{value:"About Compile",id:"about-compile",children:[]}]}],c={toc:s};function d(e){var t=e.components,n=(0,f.Z)(e,["components"]);return(0,r.kt)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"This guide introduces the development process of smart contracts and issues should be noticed during development process from the perspective of the developer. It guides developers to quickly develop high-quality smart contracts on the Alaya network. Mainly from the following aspects to explain\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#development-manual"},"Development Manual")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#migrate-contract"},"Migrate Contract")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#crowdfunding-contract"},"Crowdfunding Contract")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#development-costs"},"Development Costs")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#best-practice"},"Best Practice")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#contract-security-development-guide"},"Contract Security Development Guide")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#faq"},"FAQ"))),(0,r.kt)("h2",{id:"development-manual"},"Development Manual"),(0,r.kt)("h3",{id:"introduction"},"Introduction"),(0,r.kt)("p",null,"This tutorial is mainly to guide users to create a simple HelloWorld smart contract using solidity language on Alaya, compile, deploy, and call this contract through alaya-truffle. If you want to use a richer API you can refer to ",(0,r.kt)("a",{parentName:"p",href:"/alaya-devdocs/en/Java_SDK"},"Java SDK")," and  ",(0,r.kt)("a",{parentName:"p",href:"/alaya-devdocs/en/JS_SDK"},"JS SDK")),(0,r.kt)("h3",{id:"alaya-truffle-introduction"},"alaya-truffle Introduction"),(0,r.kt)("p",null,"alaya-truffle is a tool provided by Alaya that can compile, deploy, and invoke smart contracts locally. For specific installation and usage manuals, refer to:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"alaya-truffle develop tools ",(0,r.kt)("a",{parentName:"li",href:"https://platon-truffle.readthedocs.io/en/alaya/getting-started/installation.html"},"specific installation")),(0,r.kt)("li",{parentName:"ul"},"alaya-truffle develop tools ",(0,r.kt)("a",{parentName:"li",href:"https://platon-truffle.readthedocs.io/en/alaya/"},"usage manuals"))),(0,r.kt)("h3",{id:"create-helloworld-contract"},"Create HelloWorld Contract"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"pragma solidity ^0.5.17;\n\ncontract HelloWorld {\n    \n    string name;\n    \n    function setName(string memory _name) public returns(string memory){\n        name = _name;\n        return name;\n    }\n    \n    function getName() public view returns(string memory){\n        return name;\n    }\n}\n")),(0,r.kt)("p",null,"Contract Files Description:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"pragma solidity ^0.5.17",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"pragma solidity"),": solidity version description\n",(0,r.kt)("inlineCode",{parentName:"li"},"0.5.17"),"\uff1asolidity version\n",(0,r.kt)("inlineCode",{parentName:"li"},"^")," \uff1aIndicates upward compatibility, that is, it can be compiled with a compiler above 0.5.17"))),(0,r.kt)("li",{parentName:"ul"},"contract HelloWorld",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"contract"),"\uff1acontract keyword\n",(0,r.kt)("inlineCode",{parentName:"li"},"HelloWorld"),"\uff1acontract name"))),(0,r.kt)("li",{parentName:"ul"},"string name",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"name"),"\uff1acontract state variables\n",(0,r.kt)("inlineCode",{parentName:"li"},"string"),"\uff1athe type of contract state variables "))),(0,r.kt)("li",{parentName:"ul"},"function setName(string memory _name) public returns(string memory)",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"function"),"\uff1afunction keyword\n",(0,r.kt)("inlineCode",{parentName:"li"},"setName"),"\uff1afunction name\n",(0,r.kt)("inlineCode",{parentName:"li"},"memory"),"\uff1adeclare the storage location of param name\uff08 function input parameters and output parameters  must be declared as memory when the parameters type is string\uff09\n",(0,r.kt)("inlineCode",{parentName:"li"},"_name"),"\uff1athe  local variables\n",(0,r.kt)("inlineCode",{parentName:"li"},"public"),"\uff1adeclare the visibility of the function\n",(0,r.kt)("inlineCode",{parentName:"li"},"name")," = _name\uff1aAssignment the local variable to state variable"))),(0,r.kt)("li",{parentName:"ul"},"function getName() public view returns(string memory)",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"view"),": this keyword means the function cannot change the blockchain state, which mainly used for query")))),(0,r.kt)("h3",{id:"compile-helloworld-contract"},"Compile HelloWorld Contract"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Step1."),"  Creat new directory for HelloWorld project "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"mkdir HelloWorld && cd HelloWorld\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Step2."),"  Init project"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"alaya-truffle init\n")),(0,r.kt)("p",null,"After the command is executed, project directory structure is as follows:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"Contracts/"),": solidity contract directory")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"Migrations/"),":  depoly file directory")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"Test/"),": test script directory")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"Truffle-config.js"),": alaya-truffle config"))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Step3."),"  Move HelloWorld contract compiled in to HelloWorld/contracts/"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"ls contracts/\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"HelloWorld.sol ")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Step4."),"  Fix compile version same as the version setted  in truffle-config.js"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"vim truffle-config.js\n")),(0,r.kt)("p",null,"Truffle-config.js content is  as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'compilers: {\n      solc: {\n            version: "^0.5.17",    // same as the version declared in HelloWorld.sol\n      }\n}\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Step5."),"  Compile contract"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"alaya-truffle compile\n")),(0,r.kt)("p",null,"After the command is executed, project directory structure is as follows:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"Build/"),": solidity contract directory after compiled")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"Build/contracts/HelloWorld.json"),":the compiled file corresponding with HelloWorld.sol  "))),(0,r.kt)("h3",{id:"deploly-helloworld-contract"},"Deploly HelloWorld Contract"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Step1.")," Create deploy script "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"cd migrations/ && touch 2_initial_helloworld.js\n")),(0,r.kt)("p",null,"Suggest replacing script  name  with contract name, for example the deploy script  of HelloWorld contract :2_initial_helloworld.js,content is as follows\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'const helloWorld = artifacts.require("HelloWorld"); //artifacts.require specify deployment contract\n    module.exports = function(deployer) {\n       deployer.deploy(helloWorld); //Failed to deploy contract with parameters, please refer to FAQ\n};\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Step2.")," Setting config  information for blockchain in truffle-config.js"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"vim truffle-config.js\n")),(0,r.kt)("p",null,"Set blockchain network  info"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'networks: {\n    development: {\n       host: "10.1.1.6",     // blockchain server address\n       port: 8806,            // server port\n       network_id: "*",       // Any network (default: none)\n       from: "atp1jtfqqqr6436ppj6ccnrh8xjg7qals3ctnnmurp", //the accout address of deploying contract\n       gas: 999999,\n       gasPrice: 50000000004,\n    },\n}\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"step3."),"  Unlock wallet account"),(0,r.kt)("p",null,"Enter the alaya-truffle console"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"alaya-truffle console\n")),(0,r.kt)("p",null,"Import the private key (you can skip this step if you have already imported it)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'web3.platon.personal.importRawKey("Your wallet private key","Your wallet password");\n')),(0,r.kt)("p",null,"After importing successfully, you will see the address corresponding to the private key as follows\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"'atp1jtfqqqr6436ppj6ccnrh8xjg7qals3ctnnmurp'\n")),(0,r.kt)("p",null,"Unlock wallet account"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"}," web3.platon.personal.unlockAccount('Your wallet address','Your wallet password',999999);\n")),(0,r.kt)("p",null,"After unlocking successfully, you will see the following information\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"ture\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Step4."),"  Deploy contract"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"alaya-truffle migrate\n")),(0,r.kt)("p",null,"After deploying successfully, you will see log info as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"2_initial_helloworld.js\n======================\n\n   Deploying 'HelloWorld'\n   ----------------------\n   > transaction hash:    0x87cd48cc467f9bc943fd096c57c8a7e7b7fa941380538d9e59797800c6c4292c\n   > Blocks: 0            Seconds: 0\n   > contract address:    atp1c5xxup4au4pqkgkm6a3p6hj3x0vvekdj52z2la\n   > block number:        282520\n   > block timestamp:     1585535169200\n   > account:             atp1jtfqqqr6436ppj6ccnrh8xjg7qals3ctnnmurp\n   > balance:             16447231233352977496646259638377769924557918764752765436645.336513079692286014\n   > gas used:            145569\n   > gas price:           1 gvon\n   > value sent:          0 ATP\n   > total cost:          0.000145569 ATP\n\n\n   > Saving migration to chain.\n   > Saving artifacts\n   -------------------------------------\n   > Total cost:          0.000145569 ATP\n\nSummary\n=======\n> Total deployments:   2\n> Final cost:          0.000259892 ATP\n")),(0,r.kt)("h3",{id:"call-helloworld-contract"},"Call HelloWorld Contract"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Step1."),"  Enter the alaya-truffle console"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"alaya-truffle console\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"You can execute command in alaya-truffle console")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Step2."),"  Create contract object"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'var abi = [{"constant":false,"inputs":[{"internalType":"string","name":"_name","type":"string"}],"name":"setName","outputs":[{"internalType":"string","name":"","type":"string"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"getName","outputs":[{"internalType":"string","name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"}]; //you can refet to HelloWorld/build/contracts/HelloWorld.json\n\nvar contractAddr = \'atp1c5xxup4au4pqkgkm6a3p6hj3x0vvekdj52z2la\';//contract address\nvar helloWorld = new web3.platon.Contract(abi,contractAddr);  \n')),(0,r.kt)("p",null,"Description\uff1a "),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"abi")," the interface provided by the contract to external calls, the abi  in the file compiled \uff1a",(0,r.kt)("inlineCode",{parentName:"li"},"HelloWorld/build/contracts/HelloWorld.json")," "),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"contractAddr")," contract address"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"helloWorld"),"  contract object created")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Step3."),"  Call contract"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"helloWorld.methods.setName(\"hello world\").send({from: 'atp1jtfqqqr6436ppj6ccnrh8xjg7qals3ctnnmurp'}).on('receipt', function(receipt) {console.log(receipt);}).on('error', console.error);\n\n")),(0,r.kt)("p",null,"Description\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"helloWorld")," the contract object created"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"methods"),"  specify the call method"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"setName")," the function of the HelloWorld contract, which has a parameter as ",(0,r.kt)("inlineCode",{parentName:"li"},"hello world")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"from")," the address of caller "),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"on")," listen to the result of the contract method executed. If failed, it will print the error info. If succeeds ,the console will print the receipt as belows:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"{ \n  blockHash:'0x3ae287d1e745e30d0d6c95d5220cc7816cda955e7b2f013c6a531ed95028a794', //the hash of block the transaction located\n  blockNumber: 159726, \n  contractAddress: null,\n  cumulativeGasUsed: 44820,\n  from: 'atp1jtfqqqr6436ppj6ccnrh8xjg7qals3ctnnmurp', //the address of caller\n  gasUsed: 44820, //gas cost\n  logsBloom:\n   '0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',\n  status: true,\n  to: 'atp1c5xxup4au4pqkgkm6a3p6hj3x0vvekdj52z2la', //contract address\n  transactionHash:'0xb7a41f72d555d4a2d9f2954fbdc5bbbb4c5ce89c836f8704276419ed416b3866', \n  transactionIndex: 0,\n  events: {} \n}\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Step4."),"  Query contract"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'helloWorld.methods.getName().call(null,function(error,result){console.log("name is:" + result);})  \n')),(0,r.kt)("p",null,"Description\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"helloWorld")," the contract object created"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"methods")," specify the call method"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"getName")," the function of the HelloWorld contract, which has no  parameter "),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"call")," specify query method"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"function")," callback result,we can use console.log to print info.")),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"migrate-contract"},"Migrate Contract"),(0,r.kt)("h3",{id:"introduction-1"},"Introduction"),(0,r.kt)("p",null,"Alaya supports four versions of solidity: 0.4.26, 0.5.17, 0.6.12, and 0.7.1. If you migrate contracts with versions above 0.7.1, you need to reduce the version number and remove the syntax related to the higher version."),(0,r.kt)("p",null,"If you want to migrate Ethereum's smart contract to Alaya, you can do this with the ",(0,r.kt)("inlineCode",{parentName:"p"},"alaya-truffle")," development tool. First, to make sure have ",(0,r.kt)("inlineCode",{parentName:"p"},"alaya-truffle")," installed correctly, just follow these steps."),(0,r.kt)("p",null,"The migration of Ethereum's ERC200513Token contract to Alaya is demonstrated below\uff0c",(0,r.kt)("inlineCode",{parentName:"p"},"ERC200513Token.sol")," contract are as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"pragma solidity 0.5.17;\n\ncontract ERC200513Token {\n    string public name; \n    string public symbol; \n    uint8 public decimals = 18;  //18 decimals is the strongly suggested default, avoid changing it\n    uint256 public totalSupply = 10000000000000000000 ether; \n\n    // This creates an array with all balances\n    mapping(address => uint256) public balanceOf;\n    mapping(address => mapping(address => uint256)) public allowance;\n\n    //This generates a public event on the blockchain that will notify clients\n    event Transfer(address indexed from, address indexed to, uint256 value);\n\n    // This notifies clients about the amount burnt\n    event Burn(address indexed from, uint256 value);\n\n    /**\n     * Constructor function\n     */\n    constructor(uint256 initialSupply, string memory tokenName, string memory tokenSymbol) public {\n        totalSupply = initialSupply * 10 ** uint256(decimals); // Update total supply with the decimal amount\n        balanceOf[msg.sender] = totalSupply; // Give the creator all initial tokens\n        name = tokenName; // Set the name for display purposes    \n        symbol = tokenSymbol; \n    }\n    /**\n     * get the name for display purposes\n     */\n    function getName() view public returns (string memory){\n        return name;\n    }\n\n    /**\n     * get token symbol\n     */\n    function getSymbol() view public returns (string memory){\n        return symbol;\n    }\n \n    function getDecimals() public view returns (uint8){\n        return decimals;\n    }\n\n    function getTotalSupply() public view returns (uint256 theTotalSupply) {\n        theTotalSupply = totalSupply;\n        return theTotalSupply;\n    }\n\n    function getBalanceOf(address _owner) public view returns (uint256 balance) {\n        //get _owner's balance\n        return balanceOf[_owner];\n    }\n    /**\n     * Transfer tokens from other address\n     */\n    function _transfer(address _from, address _to, uint _value) internal returns (bool success){\n        // Make sure the destination address is not 0x0, Because address 0x0 represents destruction\n        require(_to != address(0x0));\n        // Check the sender balance\n        require(balanceOf[_from] >= _value);\n        // Make sure _value>0\n        require(balanceOf[_to] + _value > balanceOf[_to]);\n\n        uint previousBalances = balanceOf[_from] + balanceOf[_to];\n        // Subtract from the sender\n        balanceOf[_from] -= _value;\n        // Add the same to the recipient\n        balanceOf[_to] += _value;\n        emit Transfer(_from, _to, _value);\n\n        return (balanceOf[_from] + balanceOf[_to] == previousBalances);\n    }\n\n    /**\n     *  Transfer tokens from other address\n     *\n     *  Send `_value` tokens to `_to` on behalf of `_from`\n     *\n     * @param _to The address of the recipient\n     * @param _value the amount to send\n     */\n    function transfer(address _to, uint256 _value) public returns (bool success){\n        return _transfer(msg.sender, _to, _value);\n    }\n\n    /**\n     * Transfer tokens from other address\n     *\n     * @param _from The address of the sender\n     * @param _to The address of the recipient\n     * @param _value the amount to send\n     */\n    function transferFrom(address _from, address _to, uint256 _value) public returns (bool success) {\n        require(_value <= allowance[_from][msg.sender]);\n        // Check allowance\n        allowance[_from][msg.sender] -= _value;\n        _transfer(_from, _to, _value);\n        return true;\n    }\n\n    /**\n     * Set allowance for other address\n     *\n     * Allows `_spender` to spend no more than `_value` tokens on your behalf\n     * \n     * @param _spender The address authorized to spend\n     * @param _value the max amount they can spend\n     */\n    function approve(address _spender, uint256 _value) public\n    returns (bool success) {\n        allowance[msg.sender][_spender] = _value;\n        return true;\n    }\n\n\n    /**\n     *\n     * Gets the remaining number of tokens that _spender can issue from account _owner\n     */\n    function getAllowance(address _owner, address _spender) public view returns (uint remaining){\n        return allowance[_owner][_spender];\n    }\n\n    /**\n     * Destroy tokens\n     *\n     * Remove `_value` tokens from the system irreversibly\n     *\n     */\n    function burn(uint256 _value) public returns (bool success) {\n        require(balanceOf[msg.sender] >= _value);\n        // Check if the sender has enough\n        balanceOf[msg.sender] -= _value;\n        // Subtract from the sender\n        totalSupply -= _value;\n        // Updates totalSupply\n        emit Burn(msg.sender, _value);\n        return true;\n    }\n\n    /**\n     * Destroy tokens from other account\n     *\n     * Remove `_value` tokens from the system irreversibly on behalf of `_from`.\n     *\n     * @param _from the address of the sender\n     * @param _value the amount of money to burn\n     */\n    function burnFrom(address _from, uint256 _value) public returns (bool success) {\n        require(balanceOf[_from] >= _value);\n        // Check if the targeted balance is enough\n        require(_value <= allowance[_from][msg.sender]);\n        // Check allowance\n        balanceOf[_from] -= _value;\n        // Subtract from the targeted balance\n        allowance[_from][msg.sender] -= _value;\n        // Subtract from the sender's allowance\n        totalSupply -= _value;\n        // Update totalSupply\n        emit Burn(_from, _value);\n        return true;\n    }\n}\n")),(0,r.kt)("h3",{id:"operation-procedure"},"Operation Procedure"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Step1.")," Create new directory for example project "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"mkdir example && cd example\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"After the command is executed,project directory structure is as follows:")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Step2."),"  Init project"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"alaya-truffle init\n")),(0,r.kt)("p",null,"After the command is executed,project directory structure is as follows:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"contracts/"),": solidity contract directory")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"migrations/"),": depoly file directory")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"test/"),": test script directory")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"truffle-config.js"),": alaya-truffle config"))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Step3.")," Move ERC200513Token contract compiled in to example/contracts"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"ls contracts/\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"ERC200513Token.sol"),(0,r.kt)("li",{parentName:"ul"},"Alaya's smart contract unit is ATP,VON. To migrate the Ethereum smart contract to Alaya,please change the Ethereum denomination to Alaya denomination.also note the ether /ATP market rate\uff08for this contract, we assume the market exchange rate1:1,uint256 public totalSupply = 10000000000000000000 ether; change to uint256 public totalSupply = 10000000000000000000 atp; \uff09"),(0,r.kt)("li",{parentName:"ul"},"The compiled version modifies the version supported by Alaya."),(0,r.kt)("li",{parentName:"ul"},"Alaya's smart contract block.timestamp is current block timestamp as milliseconds since unix epoch, and Ethereum smart contract is seconds.")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Step4.")," Modify the compilation version number and chain-dependent configuration in truffle-config.js"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'module.exports = {\n  networks: {\n     development: {\n      host: "10.1.1.6",     // chain address\n      port: 8806,            // chain rpc port\n      network_id: "*",       // Any network (default: none)\n      from: "atp1jtfqqqr6436ppj6ccnrh8xjg7qals3ctnnmurp", // the wallet address of deployment contract \n      gas: 999999,\n      gasPrice: 50000000004,         \n     },\n  },\n\n  compilers: {\n    solc: {\n       version: "0.5.17",    // the version number used in compiling the contract is the same as the contract definition\n       docker: false,        // Use "0.5.1" you\'ve installed locally with docker\n    }\n  }\n}\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Step5.")," Compile contract"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"alaya-truffle compile\n")),(0,r.kt)("p",null,"The following is the output of the successful compilation\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"Compiling your contracts...\nCompiling ./contracts/ERC200513Token.sol\nCompiling ./contracts/Migrations.sol\n  compilation warnings encountered:\n\nWarning: This is a pre-release compiler version, please do not use it in production.\nArtifacts written to /home/guest/example/build/contracts\nCompiled successfully using: \n  solc: 0.5.17+commit.d117da36.Emscripten.clang\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Step6.")," Create deploy script "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"cd migrations && touch 2_initial_ERC200513Token.js\n")),(0,r.kt)("p",null,"Deploy script 2_initial_ERC200513Token.js content is as follows\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"const ERC200513Token = artifacts.require(\"ERC200513Token\"); //contract class name\nmodule.exports = function(deployer) {\n  deployer.deploy(ERC200513Token,100,'PLA','PLAT'); //ERC200513Token abstract and constructor params\n};  \n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Step7.")," Deploy contract"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"alaya-truffle migrate\n")),(0,r.kt)("p",null,"After deploying successfully, you will see log info as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"Compiling your contracts...\nEverything is up to date, there is nothing to compile.\n2_initial_ERC200513Token.js\n   Deploying 'ERC200513Token'\n     transaction hash:    0xa1770aecf4cffb0e75a172e06e75a9e9cb2d36bf89291b57d504e8c054985e99\n     Blocks: 0            Seconds: 0\n     contract address:    atp1kekwl4v2q0qc0g9cr6c8adsx0p2n7c90ygp5tv//new contract address\n     block number:        265657\n     block timestamp:     1581742216965\n     account:             atp1jtfqqqr6436ppj6ccnrh8xjg7qals3ctnnmurp\n     balance:             90000000.826385379994114416\n     gas used:            638876\n     gas price:           50.000000004 gVON\n     value sent:          0 ATP\n     total cost:          0.031943800002555504 ATP\n     Saving migration to chain.\n     Saving artifacts\n     Total cost:     0.031943800002555504 ATP\nSummary\n Total deployments:   2\n Final cost:          0.037844150003027532 ATP\n")),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"crowdfunding-contract"},"Crowdfunding Contract"),(0,r.kt)("h3",{id:"introduction-2"},"Introduction"),(0,r.kt)("p",null,"In the following example, we will use smart contract for a crowdfunding campaign. The creator of the contract started crowdfunding, and initialized the number of tokens and the duration of the crowdfunding. If the crowdfunding is completed within a specified time, the crowdfunding will be successful. If the crowdfunding switch is turned off, a certain number of tokens based on a fixed exchange rate will be cast and credited to the name of the investor. Otherwise, the crowdfunding fails and the amount of the crowdfunding is returned to the investors."),(0,r.kt)("p",null,"There are two roles in the contract"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Crowdfunder"),(0,r.kt)("li",{parentName:"ul"},"Investor")),(0,r.kt)("h3",{id:"crowdfunding-process"},"Crowdfunding Process"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"1.Creating a crowdfunding contract refers to the beneficiary."),(0,r.kt)("li",{parentName:"ul"},"2.Deployment crowdfunding contract initializes the number and duration of crowdfunding tokens."),(0,r.kt)("li",{parentName:"ul"},"3.Investors invest."),(0,r.kt)("li",{parentName:"ul"},"4.Determine if crowdfunding is over.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"If the crowdfunding time is not up and the number of crowdfunding tokens has been completed, turn off the crowdfunding switch, investors will be allocated tokens in proportion. Crowdfunding success."),(0,r.kt)("li",{parentName:"ul"},"If the crowdfunding time is up and the amount of crowdfunding tokens has been completed, investors will be allocated tokens in proportion. Crowdfunding success."),(0,r.kt)("li",{parentName:"ul"},"If the crowdfunding time is up and the number of crowdfunding tokens is not completed, the investor tokens will be returned. Crowdfunding failure.")))),(0,r.kt)("h3",{id:"crowdfunding-contract-1"},"Crowdfunding Contract"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"pragma solidity ^0.5.17;\n\ncontract CrowdFunding {\n    address payable public beneficiaryAddress = address(0x0); //Beneficiary address, set as contract creator\n    uint256 public fundingGoal = 100 atp;  //Crowdfunding target, unit is ATP\n    uint256 public amountRaised = 0; //The amount of money raised,the unit is VON\n    uint256 public deadline; \n    uint256 public price;  //token price\n    bool public fundingGoalReached = false;  //Achieving crowdfunding goals flag\n    bool public crowdsaleClosed = false; //Crowdfunding closed\n\n    mapping(address => uint256) public balance; //Save the amount raised by the investor\n    \n    mapping(address => uint256) public tokenMap; //Save the number of tokens owned by the investor\n\n    //Record received ATP notifications\n    event GoalReached(address _beneficiaryAddress, uint _amountRaised);\n\n    //Transfer notice\n    event FundTransfer(address _backer, uint _amount, bool _isContribution);\n    \n    //Check if the address is empty\n    modifier validAddress(address _address) {\n        require(_address != address(0x0));\n        _;\n    }\n\n    /**\n     * Initialization constructor\n     *\n     * @param _fundingGoalInlats: Total crowdfunding ATP coin\n     * @param _durationInMinutes: Crowdfunding deadline, unit is minute\n     */\n    constructor (\n        uint _fundingGoalInlats,\n        uint _durationInMinutes\n    )public {\n        beneficiaryAddress = msg.sender;\n        fundingGoal = _fundingGoalInlats * 1 atp;\n        deadline = now + _durationInMinutes * 1 minutes;\n        price = 500 finney; //1\u4e2aATP\u5e01\u53ef\u4ee5\u4e70 2 \u4e2a\u4ee3\u5e01\n    }\n\n\n    /**\n     * fallback functioin\n     *\n     * you can send money directly to the contract\n     */\n    function () payable external {\n\n        //check whether to close crowdfunding\n        require(!crowdsaleClosed);\n        uint amount = msg.value;\n\n        //investor amount accumulated\n        balance[msg.sender] += amount;\n\n        //Total invest accumulated\n        amountRaised += amount;\n\n        //Transfer operation, how many tokens are transferred to the investor\n        tokenMap[msg.sender]  += amount / price;\n        \n        emit FundTransfer(msg.sender, amount, true);\n    }\n\n    /**\n     * Determine if the crowdfunding deadline has passed\n     */\n    modifier afterDeadline() { if (now >= deadline) _; }\n\n    /**\n     * Check if the crowdfunding goal has been reached\n     */\n    function checkGoalReached() public afterDeadline payable{\n        if (amountRaised >= fundingGoal){\n            //crowdfunding goal has been reached\n            fundingGoalReached = true;\n            emit GoalReached(beneficiaryAddress, amountRaised);\n        }\n\n        //Closing crowdfunding\n        crowdsaleClosed = true;\n    }\n\n\n    /**\n     * Recover funds\n     *\n     * Check if the target or time limit has been reached, and if so, send the full amount to the beneficiary.\n     * If the goal is not reached, each investor can return the amount they invested\n     */\n    function safeWithdrawal() public afterDeadline {\n\n        //If the crowdfunding goal is not reached\n        if (!fundingGoalReached) {\n            //Get the contracted caller's donated balance\n            uint amount = balance[msg.sender];\n\n            if (amount > 0) {\n                //Returns all balances of the contract initiator\n                msg.sender.transfer(amount);\n                emit FundTransfer(msg.sender, amount, false);\n                balance[msg.sender] = 0;\n            }\n        }\n\n        //f the crowdfunding goal is achieved and the contract caller is the beneficiary\n        if (fundingGoalReached && beneficiaryAddress == msg.sender) {\n\n            //Give all donations from the contract to the beneficiary\n            beneficiaryAddress.transfer(amountRaised);\n            \n            emit FundTransfer(beneficiaryAddress, amountRaised, false);\n        }\n    }\n}\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Compile Crowdfunding Contract")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Step1.")," Create new directory for Crowdfunding project "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"mkdir myCrowdFunding && cd myCrowdFunding\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"The following commands are performed in the myCrowdFunding directory without special instructions.")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Step2.")," Init project"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"alaya-truffle init\n")),(0,r.kt)("p",null,"After the command is executed, project directory structure is as follows:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"contracts/"),": solidity contract directory"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"migrations/"),": depoly file directory"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"test/"),": test script directory"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"truffle-config.js"),": alaya-truffle config")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Step3.")," Move crowdfunding contract compiled in to ",(0,r.kt)("inlineCode",{parentName:"p"},"myCrowdFunding/contracts/")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"ls myCrowdFunding/contracts/\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Files in the directory: ",(0,r.kt)("inlineCode",{parentName:"p"},"crowdFunding.sol"),".")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Step4.")," Fix compile version same as the version setted  in truffle-config.js"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"vim truffle-config.js\n")),(0,r.kt)("p",null,"Truffle-config.js content is  as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'compilers: {\n     solc: {\n        version: "0.5.17",    //same as the version declared in CrowdFunding.sol\n    }\n}\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Step5.")," Compile contract"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"alaya-truffle compile\n")),(0,r.kt)("p",null,"After the command is executed, project directory structure is as follows:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"build/"),": solidity contract directory after compiled"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"build/contracts/CrowdFunding.json"),": the compiled file corresponding with CrowdFunding.sol")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Deploly crowdfunding Contract")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Step1.")," Create deploy script "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"cd migrations/ && touch 2_initial_CrowdFunding.js\n")),(0,r.kt)("p",null,"Deploy script 2_initial_crowdFunding.js,content is as follows\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'const CrowdFunding = artifacts.require("CrowdFunding"); //deployment contract class name\nmodule.exports = function(deployer) {\n      deployer.deploy(CrowdFunding,1000000,100);\n};\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Step2.")," Setting config  information for blockchain in truffle-config.js"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"vim truffle-config.js\n")),(0,r.kt)("p",null,"Set blockchain network  info"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'networks: {\n    development: {\n       host: "10.1.1.6",     // blockchain server address\n       port: 8806,            // server port\n       network_id: "*",       // Any network (default: none)\n       from: "atp1jtfqqqr6436ppj6ccnrh8xjg7qals3ctnnmurp", //the accout address of deploying contract\n       gas: 999999,\n       gasPrice: 50000000004,\n    },\n}\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Step3.")," Deploy contract"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"alaya-truffle migrate\n")),(0,r.kt)("p",null,"After deploying successfully, you will see log info as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"Compiling your contracts...\n Everything is up to date, there is nothing to compile.\n 3_initial_CrowdFunding.js\n \n    Deploying 'CrowdFunding'\n     transaction hash:    0x3a6419cd4169d7cfb430a1fc5632239ac4a01845827f20df9b3229a334c5488b\n     Blocks: 0            Seconds: 0\n     contract address:    atp1crcjuu9uwa9aukmf5dr5tq4ym6cv2kre0042ya //contract address\n     block number:        280532\n     block timestamp:     1581751224032\n     account:             atp1jtfqqqr6436ppj6ccnrh8xjg7qals3ctnnmurp\n     balance:             90000000.806077629992489796\n     gas used:            379154\n     gas price:           50.000000004 gVON\n     value sent:          0 ATP\n     total cost:          0.018957700001516616 ATP\n \n     Saving migration to chain.\n     Saving artifacts\n     Total cost:     0.018957700001516616 ATP\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Crowdfounding Query\uff1a")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Step1."),"  Enter the alaya-truffle console"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"alaya-truffle console\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"You can execute command in alaya-truffle console")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Step2."),"  Create contract object"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"var abi = [...]; //ABI of CrowdFunding contract,can get from build/contracts/CrowdFunding.json\nvar contractAddr = 'atp1crcjuu9uwa9aukmf5dr5tq4ym6cv2kre0042ya'; //CrowdFundsing contract address\nvar crowdFunding = new web3.platon.Contract(abi,contractAddr);\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Step3."),"  Query the amount raised"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'crowdFunding.methods.amountRaised().call(null,function(error,result){console.log("result:" + result);}); //query the amount raised\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Step4."),"  Crowdfunder judge the success of crowdfunding"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"crowdFunding.methods.safeWithdrawal().send({from:'atp1jtfqqqr6436ppj6ccnrh8xjg7qals3ctnnmurp'}).on('data', function(event){ console.log(event);}).on('error', console.error); \n")),(0,r.kt)("p",null,"Call contract command description:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"crowdFunding")," is the contract object we built earlier"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"methods")," fixed syntax specifying that methods in the contract will be obtained"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"safeWithdrawal")," is a method in our crowdfunding contract to recover funds"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"from")," caller's wallet address"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"on")," listen for contract processing result events, and output error logs for failures")),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"development-costs"},"Development Costs"),(0,r.kt)("h3",{id:"introduction-3"},"Introduction"),(0,r.kt)("p",null,"In a blockchain system, developing smart contracts based on any public chain system involves the development cost of resource expenditure. For example, deploying/calling smart contracts on the network, performing energy conversion, pledge/delegation and other operations all require a certain cost. Different blockchain network development costs are different. The cost of developing smart contracts on the Alaya network is similar to that of developing on Ethereum. This manual will analyze and compare in an intuitive format, allowing users to have a clearer understanding of development costs."),(0,r.kt)("h3",{id:"summary"},"Summary"),(0,r.kt)("p",null,"This article will use a table to compare different development costs of small, medium and large contracts, and compare Alaya with Ethereum. In terms of contracts, a simple ",(0,r.kt)("inlineCode",{parentName:"p"},"SET/GET")," function contract is used as a small test contract. The medium-sized contract example will use an open source(",(0,r.kt)("a",{parentName:"p",href:"https://github.com/yep/eth-tweet"},"eth-tweet"),") contract The large contract is a smart contract that complies with the ERC20 standard."),(0,r.kt)("h4",{id:"data-overview"},"Data Overview"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Simple Storage Contract")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Platform"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Contract Level"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Size"),(0,r.kt)("th",{parentName:"tr",align:"left"},"GasUsed"),(0,r.kt)("th",{parentName:"tr",align:"left"},"GasPrice"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Amount"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Remark"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Alaya"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Small-sized"),(0,r.kt)("td",{parentName:"tr",align:"left"},"0.3 kb"),(0,r.kt)("td",{parentName:"tr",align:"left"},"76953"),(0,r.kt)("td",{parentName:"tr",align:"left"},"5,000,000,000 ",(0,r.kt)("inlineCode",{parentName:"td"},"VON")),(0,r.kt)("td",{parentName:"tr",align:"left"},"384765 ",(0,r.kt)("inlineCode",{parentName:"td"},"gVON")),(0,r.kt)("td",{parentName:"tr",align:"left"},"0.000384765 ",(0,r.kt)("inlineCode",{parentName:"td"},"ATP"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Ethereum"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Small-sized"),(0,r.kt)("td",{parentName:"tr",align:"left"},"0.3 kb"),(0,r.kt)("td",{parentName:"tr",align:"left"},"127173"),(0,r.kt)("td",{parentName:"tr",align:"left"},"5,000,000,000 ",(0,r.kt)("inlineCode",{parentName:"td"},"wei")),(0,r.kt)("td",{parentName:"tr",align:"left"},"635865 ",(0,r.kt)("inlineCode",{parentName:"td"},"Gwei")),(0,r.kt)("td",{parentName:"tr",align:"left"},"0.000635865 ",(0,r.kt)("inlineCode",{parentName:"td"},"ETH"))))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"eth-tweet Contract")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Platform"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Contract Level"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Size"),(0,r.kt)("th",{parentName:"tr",align:"left"},"GasUsed"),(0,r.kt)("th",{parentName:"tr",align:"left"},"GasPrice"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Amount"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Remark"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Alaya"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Medium-sized"),(0,r.kt)("td",{parentName:"tr",align:"left"},"2.08 kb"),(0,r.kt)("td",{parentName:"tr",align:"left"},"257065"),(0,r.kt)("td",{parentName:"tr",align:"left"},"5,000,000,000 ",(0,r.kt)("inlineCode",{parentName:"td"},"VON")),(0,r.kt)("td",{parentName:"tr",align:"left"},"1285325 ",(0,r.kt)("inlineCode",{parentName:"td"},"gVON")),(0,r.kt)("td",{parentName:"tr",align:"left"},"0.001285325 ",(0,r.kt)("inlineCode",{parentName:"td"},"ATP"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Ethereum"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Medium-sized"),(0,r.kt)("td",{parentName:"tr",align:"left"},"2.08 kb"),(0,r.kt)("td",{parentName:"tr",align:"left"},"621385"),(0,r.kt)("td",{parentName:"tr",align:"left"},"5,000,000,000 ",(0,r.kt)("inlineCode",{parentName:"td"},"wei")),(0,r.kt)("td",{parentName:"tr",align:"left"},"3106925 ",(0,r.kt)("inlineCode",{parentName:"td"},"Gwei")),(0,r.kt)("td",{parentName:"tr",align:"left"},"0.003106925 ",(0,r.kt)("inlineCode",{parentName:"td"},"ETH"))))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"ERC20 Token Contract")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Platform"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Contract Level"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Size"),(0,r.kt)("th",{parentName:"tr",align:"left"},"GasUsed"),(0,r.kt)("th",{parentName:"tr",align:"left"},"GasPrice"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Amount"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Remark"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Alaya"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Large-sized"),(0,r.kt)("td",{parentName:"tr",align:"left"},"4.45 kb"),(0,r.kt)("td",{parentName:"tr",align:"left"},"552823"),(0,r.kt)("td",{parentName:"tr",align:"left"},"5,000,000,000 ",(0,r.kt)("inlineCode",{parentName:"td"},"VON")),(0,r.kt)("td",{parentName:"tr",align:"left"},"2764115  ",(0,r.kt)("inlineCode",{parentName:"td"},"gVON")),(0,r.kt)("td",{parentName:"tr",align:"left"},"0.002764115 ",(0,r.kt)("inlineCode",{parentName:"td"},"ATP"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"Ethereum"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Large-sized"),(0,r.kt)("td",{parentName:"tr",align:"left"},"4.45 kb"),(0,r.kt)("td",{parentName:"tr",align:"left"},"1282171"),(0,r.kt)("td",{parentName:"tr",align:"left"},"5,000,000,000 ",(0,r.kt)("inlineCode",{parentName:"td"},"wei")),(0,r.kt)("td",{parentName:"tr",align:"left"},"6410855  ",(0,r.kt)("inlineCode",{parentName:"td"},"Gwei")),(0,r.kt)("td",{parentName:"tr",align:"left"},"0.006410855 ",(0,r.kt)("inlineCode",{parentName:"td"},"ETH"))))),(0,r.kt)("h3",{id:"small-sized-contract"},"Small-sized Contract"),(0,r.kt)("h4",{id:"simple-storage-contract"},"Simple Storage Contract"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Sample Code")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"pragma solidity ^0.4.12;\n\ncontract SimpleTest {\n    \n    uint public age;\n \n    function setAge(uint _input) public {\n        age = _input;\n    }\n \n    function getAge() public constant returns (uint) {\n        return age;\n    }\n}\n")),(0,r.kt)("p",null,"ByteCode"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"608060405234801561001057600080fd5b50610117806100206000396000f3006080604052600436106053576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063262a9dff146058578063967e6e65146080578063d5dcf1271460a8575b600080fd5b348015606357600080fd5b50606a60d2565b6040518082815260200191505060405180910390f35b348015608b57600080fd5b50609260d8565b6040518082815260200191505060405180910390f35b34801560b357600080fd5b5060d06004803603810190808035906020019092919050505060e1565b005b60005481565b60008054905090565b80600081905550505600a165627a7a7230582079e51340567895e1097e1c9115e778c3d982b8e71b6997c57f1ba497c56c8b3b0029\n")),(0,r.kt)("p",null,"ByteSize\uff1a",(0,r.kt)("inlineCode",{parentName:"p"},"311 byte => 0.3 kb")),(0,r.kt)("h6",{id:"cost"},"Cost"),(0,r.kt)("p",null,"Alaya"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"GasUsed: 76953"),(0,r.kt)("li",{parentName:"ul"},"GasPrice: 5,000,000,000 (5 ",(0,r.kt)("inlineCode",{parentName:"li"},"gVON"),")"),(0,r.kt)("li",{parentName:"ul"},"Costs:  384765 ",(0,r.kt)("inlineCode",{parentName:"li"},"gVON"),"\uff080.000384765 ",(0,r.kt)("inlineCode",{parentName:"li"},"ATP"),"\uff09")),(0,r.kt)("p",null,"Ethereum"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"GasUsed: 127173 "),(0,r.kt)("li",{parentName:"ul"},"GasPrice: 5,000,000,000 (5 ",(0,r.kt)("inlineCode",{parentName:"li"},"Gwei"),")"),(0,r.kt)("li",{parentName:"ul"},"Costs:  635865 ",(0,r.kt)("inlineCode",{parentName:"li"},"Gwei"),"\uff080.000635865 ",(0,r.kt)("inlineCode",{parentName:"li"},"ETH"),"\uff09")),(0,r.kt)("hr",null),(0,r.kt)("h3",{id:"medium-sized-contract"},"Medium-sized Contract"),(0,r.kt)("h4",{id:"eth-tweet"},"Eth-Tweet"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Sample Code")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/PlatONnetwork/alaya-devdocs/blob/master/alaya-devdocs/SmartDevelopment.assets/account.sol"},"Click to view code")),(0,r.kt)("p",null,"ByteCode"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"6060604052341561000f57600080fd5b5b600060018190555033600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b5b6107e88061006a6000396000f3006060604052361561008c576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680630c4f65bd146100915780633e450fff146100e65780635c3e426c146100fb578063ae978f0814610134578063b6db75a0146101d1578063c3ad5ecb146101fe578063ca7dc5b1146102a2578063fb46d4c5146102cb575b600080fd5b341561009c57600080fd5b6100a461033c565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34156100f157600080fd5b6100f9610367565b005b341561010657600080fd5b610132600480803573ffffffffffffffffffffffffffffffffffffffff169060200190919050506103b2565b005b341561013f57600080fd5b610147610411565b6040518080602001848152602001838152602001828103825285818151815260200191508051906020019080838360005b838110156101945780820151818401525b602081019050610178565b50505050905090810190601f1680156101c15780820380516001836020036101000a031916815260200191505b5094505050505060405180910390f35b34156101dc57600080fd5b6101e46104f7565b604051808215151515815260200191505060405180910390f35b341561020957600080fd5b61021f6004808035906020019091905050610550565b6040518080602001838152602001828103825284818151815260200191508051906020019080838360005b838110156102665780820151818401525b60208101905061024a565b50505050905090810190601f1680156102935780820380516001836020036101000a031916815260200191505b50935050505060405180910390f35b34156102ad57600080fd5b6102b5610628565b6040518082815260200191505060405180910390f35b34156102d657600080fd5b610326600480803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091905050610633565b6040518082815260200191505060405180910390f35b6000600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1690505b90565b61036f6104f7565b156103af57600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16ff5b5b565b6103ba6104f7565b1561040d578073ffffffffffffffffffffffffffffffffffffffff166108fc3073ffffffffffffffffffffffffffffffffffffffff16319081150290604051600060405180830381858888f19350505050505b5b50565b610419610703565b600080600080600180540381526020019081526020016000206001018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156104c95780601f1061049e576101008083540402835291602001916104c9565b820191906000526020600020905b8154815290600101906020018083116104ac57829003601f168201915b505050505092506000806001805403815260200190815260200160002060000154915060015490505b909192565b6000600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161490505b90565b610558610703565b60008060008481526020019081526020016000206001018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156106035780601f106105d857610100808354040283529160200191610603565b820191906000526020600020905b8154815290600101906020018083116105e657829003601f168201915b505050505091506000808481526020019081526020016000206000015490505b915091565b600060015490505b90565b600061063d6104f7565b151561066b577fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff90506106fd565b60a08251111561069d577ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe90506106fc565b4260008060015481526020019081526020016000206000018190555081600080600154815260200190815260200160002060010190805190602001906106e4929190610717565b50600160008154809291906001019190505550600090505b5b5b919050565b602060405190810160405280600081525090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061075857805160ff1916838001178555610786565b82800160010185558215610786579182015b8281111561078557825182559160200191906001019061076a565b5b5090506107939190610797565b5090565b6107b991905b808211156107b557600081600090555060010161079d565b5090565b905600a165627a7a7230582004bd291e77dd5f2bfd4822ec9590d7da613bf3ef8cb6270dc7d553fa687ab1780029\n")),(0,r.kt)("p",null,"ByteSize\uff1a ",(0,r.kt)("inlineCode",{parentName:"p"},"2130.5 byte => 2.08 kb")),(0,r.kt)("h6",{id:"cost-1"},"Cost"),(0,r.kt)("p",null,"Alaya"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"GasUsed: 257065"),(0,r.kt)("li",{parentName:"ul"},"GasPrice: 5,000,000,000 (5 ",(0,r.kt)("inlineCode",{parentName:"li"},"gVON"),")"),(0,r.kt)("li",{parentName:"ul"},"Costs:  1285325 ",(0,r.kt)("inlineCode",{parentName:"li"},"gVON"),"\uff080.001285325 ",(0,r.kt)("inlineCode",{parentName:"li"},"ATP"),"\uff09")),(0,r.kt)("p",null,"Ethereum"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"GasUsed: 621385 "),(0,r.kt)("li",{parentName:"ul"},"GasPrice: 5,000,000,000 (5 ",(0,r.kt)("inlineCode",{parentName:"li"},"Gwei"),")"),(0,r.kt)("li",{parentName:"ul"},"Costs:  3106925 ",(0,r.kt)("inlineCode",{parentName:"li"},"Gwei"),"\uff080.003106925 ",(0,r.kt)("inlineCode",{parentName:"li"},"ETH"),"\uff09")),(0,r.kt)("hr",null),(0,r.kt)("h3",{id:"large-sized-contract"},"Large-sized Contract"),(0,r.kt)("h4",{id:"erc20-token-contract"},"ERC20 Token Contract"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Sample Code")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/PlatONnetwork/alaya-devdocs/blob/master/alaya-devdocs/SmartDevelopment.assets/token.sol"},"Click to view code")),(0,r.kt)("p",null,"ByteCode"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"6060604052604060405190810160405280600481526020017f56302e3100000000000000000000000000000000000000000000000000000000815250600690805190602001906200005292919062000139565b5034156200005c57fe5b604051620011cd380380620011cd833981016040528080519060200190919080518201919060200180519060200190919080518201919050505b83600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002081905550836000819055508260039080519060200190620000f992919062000139565b5081600460006101000a81548160ff021916908360ff16021790555080600590805190602001906200012d92919062000139565b505b50505050620001e8565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106200017c57805160ff1916838001178555620001ad565b82800160010185558215620001ad579182015b82811115620001ac5782518255916020019190600101906200018f565b5b509050620001bc9190620001c0565b5090565b620001e591905b80821115620001e1576000816000905550600101620001c7565b5090565b90565b610fd580620001f86000396000f300606060405236156100ad576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806306fdde03146100c3578063095ea7b31461015c57806318160ddd146101b357806323b872dd146101d9578063313ce5671461024f57806354fd4d501461027b57806370a082311461031457806395d89b411461035e578063a9059cbb146103f7578063cae9ca511461044e578063dd62ed3e146104e8575b34156100b557fe5b6100c15b60006000fd5b565b005b34156100cb57fe5b6100d3610551565b6040518080602001828103825283818151815260200191508051906020019080838360008314610122575b805182526020831115610122576020820191506020810190506020830392506100fe565b505050905090810190601f16801561014e5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561016457fe5b610199600480803573ffffffffffffffffffffffffffffffffffffffff169060200190919080359060200190919050506105ef565b604051808215151515815260200191505060405180910390f35b34156101bb57fe5b6101c36106e2565b6040518082815260200191505060405180910390f35b34156101e157fe5b610235600480803573ffffffffffffffffffffffffffffffffffffffff1690602001909190803573ffffffffffffffffffffffffffffffffffffffff169060200190919080359060200190919050506106e8565b604051808215151515815260200191505060405180910390f35b341561025757fe5b61025f610969565b604051808260ff1660ff16815260200191505060405180910390f35b341561028357fe5b61028b61097c565b60405180806020018281038252838181518152602001915080519060200190808383600083146102da575b8051825260208311156102da576020820191506020810190506020830392506102b6565b505050905090810190601f1680156103065780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561031c57fe5b610348600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050610a1a565b6040518082815260200191505060405180910390f35b341561036657fe5b61036e610a64565b60405180806020018281038252838181518152602001915080519060200190808383600083146103bd575b8051825260208311156103bd57602082019150602081019050602083039250610399565b505050905090810190601f1680156103e95780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34156103ff57fe5b610434600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091908035906020019091905050610b02565b604051808215151515815260200191505060405180910390f35b341561045657fe5b6104ce600480803573ffffffffffffffffffffffffffffffffffffffff1690602001909190803590602001909190803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091905050610c70565b604051808215151515815260200191505060405180910390f35b34156104f057fe5b61053b600480803573ffffffffffffffffffffffffffffffffffffffff1690602001909190803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050610f21565b6040518082815260200191505060405180910390f35b60038054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156105e75780601f106105bc576101008083540402835291602001916105e7565b820191906000526020600020905b8154815290600101906020018083116105ca57829003601f168201915b505050505081565b600081600260003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508273ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925846040518082815260200191505060405180910390a3600190505b92915050565b60005481565b600081600160008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054101580156107b5575081600260008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205410155b80156107c15750600082115b156109585781600160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000828254019250508190555081600160008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000828254039250508190555081600260008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825403925050819055508273ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef846040518082815260200191505060405180910390a360019050610962565b60009050610962565b5b9392505050565b600460009054906101000a900460ff1681565b60068054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610a125780601f106109e757610100808354040283529160200191610a12565b820191906000526020600020905b8154815290600101906020018083116109f557829003601f168201915b505050505081565b6000600160008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205490505b919050565b60058054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610afa5780601f10610acf57610100808354040283529160200191610afa565b820191906000526020600020905b815481529060010190602001808311610add57829003601f168201915b505050505081565b600081600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205410158015610b535750600082115b15610c605781600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000828254039250508190555081600160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825401925050819055508273ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef846040518082815260200191505060405180910390a360019050610c6a565b60009050610c6a565b5b92915050565b600082600260003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508373ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925856040518082815260200191505060405180910390a38373ffffffffffffffffffffffffffffffffffffffff1660405180807f72656365697665417070726f76616c28616464726573732c75696e743235362c81526020017f616464726573732c627974657329000000000000000000000000000000000000815250602e01905060405180910390207c01000000000000000000000000000000000000000000000000000000009004338530866040518563ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018481526020018373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001828051906020019080838360008314610ec0575b805182526020831115610ec057602082019150602081019050602083039250610e9c565b505050905090810190601f168015610eec5780820380516001836020036101000a031916815260200191505b5094505050505060006040518083038160008761646e5a03f1925050501515610f155760006000fd5b600190505b9392505050565b6000600260008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205490505b929150505600a165627a7a723058200cefa2ee536584300e6123cee2abeafcf9ab9388caf67ee95580f02e5587008d0029\n")),(0,r.kt)("p",null,"ByteSize\uff1a ",(0,r.kt)("inlineCode",{parentName:"p"},"4557.5 byte => 4.45 kb")),(0,r.kt)("h6",{id:"cost-2"},"Cost"),(0,r.kt)("p",null,"Alaya"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"GasUsed: 552823"),(0,r.kt)("li",{parentName:"ul"},"GasPrice: 5,000,000,000 (5 ",(0,r.kt)("inlineCode",{parentName:"li"},"gVON"),")"),(0,r.kt)("li",{parentName:"ul"},"Costs:  2764115 ",(0,r.kt)("inlineCode",{parentName:"li"},"gVON"),"\uff080.002764115 ",(0,r.kt)("inlineCode",{parentName:"li"},"ATP"),"\uff09")),(0,r.kt)("p",null,"Ethereum"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"GasUsed: 1282171 "),(0,r.kt)("li",{parentName:"ul"},"GasPrice: 5,000,000,000 (5 ",(0,r.kt)("inlineCode",{parentName:"li"},"Gwei"),")"),(0,r.kt)("li",{parentName:"ul"},"Costs:  6410855 ",(0,r.kt)("inlineCode",{parentName:"li"},"Gwei"),"\uff080.006410855 ",(0,r.kt)("inlineCode",{parentName:"li"},"ETH"),"\uff09")),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"best-practice"},"Best Practice"),(0,r.kt)("h3",{id:"introduction-4"},"Introduction"),(0,r.kt)("p",null,"This guide introduces users with some key points that need to be paid attention in the development of smart contracts, mainly in the practice of actual development. Users can use this guide to quickly understand how to set a reasonable fee for a transaction, how to avoid losing the fee due to transaction failure, and how to encode a more standardized smart contract."),(0,r.kt)("h3",{id:"reasonable-cost-setting"},"Reasonable Cost Setting"),(0,r.kt)("p",null,'When you need to deploy a contract on the main network of Alaya, you need to set a reasonable fee limit. The fee limit refers to the upper limit of the energy consumption cost of smart contract deployment/execution in Alaya. This restriction is mainly accomplished through Gas. Gas is the fuel value of the Alaya network world, which determines the normal operation of the Alaya network ecosystem. Gas is usually used to measure how much "work" is required to perform certain actions, and these workloads are the amount of fees that need to be paid to the Alaya network in order to perform the action. In a simple understanding, Gas is the commission for network miners, and is paid by ATP. Any transaction, contract execution, and data storage on the network need to use Gas.'),(0,r.kt)("p",null,"Alaya is similar to Ethereum's blockchain system. It uses ",(0,r.kt)("inlineCode",{parentName:"p"},"ATP")," for payment and maintenance networks. One ATP is divided into:",(0,r.kt)("inlineCode",{parentName:"p"},"mATP/uATP/gVON/mVON/kVON/VON"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"VON")," is the smallest unit."),(0,r.kt)("p",null,"Gas consists of two parts: GasLimit and GasPrice. ",(0,r.kt)("inlineCode",{parentName:"p"},"GasLimit")," is the maximum",(0,r.kt)("inlineCode",{parentName:"p"}," Gas")," consumption (minimum 21,000) that a user is willing to pay to perform an operation or confirm a transaction. GasPrice is the unit price of each Gas."),(0,r.kt)("p",null,"When a user sends a transaction, GasLimit and GasPrice are set. ",(0,r.kt)("inlineCode",{parentName:"p"},"GasLimit * GasPrice")," is the user's transaction cost, and the cost is rewarded to the miner as a commission."),(0,r.kt)("p",null,"The higher the GasPrice of the transaction, the higher the execution priority of the transaction and the greater the transaction cost. After each transaction is completed, the remaining unused Gas will be returned to the sender's address account. It is important to note that if the execution of the transaction fails due to the GasLimit is too low, the Gas will not be returned to the user's address at this time, and the user still needs to pay the energy cost for the failed transaction. Therefore, regardless of whether the transaction is executed successfully, the transaction sender needs to pay a certain calculation fee to the miner."),(0,r.kt)("p",null,"In the ",(0,r.kt)("inlineCode",{parentName:"p"},"Alaya")," network, the maximum gas limit is",(0,r.kt)("inlineCode",{parentName:"p"}," 4,700,000")," and the minimum is ",(0,r.kt)("inlineCode",{parentName:"p"},"22,000"),". Too low or too high will cause transaction failure. When deploying large contracts or calling complex functions in contracts, you can increase the gas limit, for example: ",(0,r.kt)("inlineCode",{parentName:"p"},"1,000,000"),". If it is a normal transfer, set it to the lowest value. The specific value needs to be estimated according to the size and complexity of the contract. Before the contract is released, the interface ",(0,r.kt)("inlineCode",{parentName:"p"},"platon_estimateGas")," can be called for approximate estimation to avoid failure due to insufficient Gas. ",(0,r.kt)("a",{parentName:"p",href:"/alaya-devdocs/en/Json_Rpc"},"Click to view JSON-RPC reference documentation"),"."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"ATP Unit Conversion")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Unit"),(0,r.kt)("th",{parentName:"tr",align:"left"},"VON Value"),(0,r.kt)("th",{parentName:"tr",align:"left"},"VON"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"VON"),(0,r.kt)("td",{parentName:"tr",align:"left"},"1"),(0,r.kt)("td",{parentName:"tr",align:"left"},"1 VON")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"kVON"),(0,r.kt)("td",{parentName:"tr",align:"left"},"1e3 VON"),(0,r.kt)("td",{parentName:"tr",align:"left"},"1,000")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"mVON"),(0,r.kt)("td",{parentName:"tr",align:"left"},"1e6 VON"),(0,r.kt)("td",{parentName:"tr",align:"left"},"1,000,000")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"gVON"),(0,r.kt)("td",{parentName:"tr",align:"left"},"1e9 VON"),(0,r.kt)("td",{parentName:"tr",align:"left"},"1,000,000,000")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"ATP"),(0,r.kt)("td",{parentName:"tr",align:"left"},"1e18 VON"),(0,r.kt)("td",{parentName:"tr",align:"left"},"1,000,000,000,000,000,000")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"mATP"),(0,r.kt)("td",{parentName:"tr",align:"left"},"1e24 VON"),(0,r.kt)("td",{parentName:"tr",align:"left"},"1,000,000,000,000,000,000,000,000")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"gATP"),(0,r.kt)("td",{parentName:"tr",align:"left"},"1e27 VON"),(0,r.kt)("td",{parentName:"tr",align:"left"},"1,000,000,000,000,000,000,000,000,000")))),(0,r.kt)("h3",{id:"avoid-timeouts"},"Avoid Timeouts"),(0,r.kt)("p",null,"Sending transactions on the Alaya network does not have the concept of timeout, but it will eventually stop according to the set gas limit value. If the limit value is lower than the consumption required for contract deployment, the transaction execution fails and the corresponding processing fee will be deducted. The fee setting cannot be infinite, because in the network, the block itself has a maximum ",(0,r.kt)("inlineCode",{parentName:"p"},"GasLimit")," value. When the GasLimit of the transaction exceeds this value, the transaction will not be accepted."),(0,r.kt)("p",null,"If the call function of a published contract is called (a call is a stateless operation in the contract logic), there is a 5s timeout limit. If the contract logic is not executed within 5s, a timeout will occur and the virtual machine will forcely exit , causing the query to fail."),(0,r.kt)("p",null,"To avoid contract-related transaction failures, try breaking large contracts into smaller pieces and referencing each other as needed. To avoid infinite loops, be aware of common pitfalls and recursive calls."),(0,r.kt)("h3",{id:"punishment-for-illegal-operations"},"Punishment For Illegal Operations"),(0,r.kt)("p",null,"If the smart contract is not compiled by a standard valid compiler, or the instruction code is changed at will, the opcode will be invalid. This type of contract not only fails to be deployed and executed successfully, but also generates a full amount (",(0,r.kt)("inlineCode",{parentName:"p"},"GasLimit * GasPrice"),") penalty. The transaction fee for the current transaction will be deducted. This is a very strong penalty. If the operator does not pay attention to this point and keep retrying, then the cost will be higher and the cost will be heavier."),(0,r.kt)("p",null,"In general, invalid opcodes have the following conditions:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Manually changed the instruction code for the normally compiled contract;"),(0,r.kt)("li",{parentName:"ol"},"The contract compiler version is not consistent with the contract version supported by the network lock;")),(0,r.kt)("p",null,"When operating a contract in the Alaya network. First, you must confirm the smart contract version supported by the current network, and then select the compiler of the corresponding version pair."),(0,r.kt)("p",null,"The normal operation is to use the latest ",(0,r.kt)("inlineCode",{parentName:"p"},"Truffle"),"/",(0,r.kt)("inlineCode",{parentName:"p"},"PlatON-CDT")," officially provided by Alaya to compile/deploy/execute the contract. At the same time, before switching to the main network, it must be validated on the test network."),(0,r.kt)("h3",{id:"coding-standards"},"Coding Standards"),(0,r.kt)("h4",{id:"naming-rules"},"Naming Rules"),(0,r.kt)("p",null,"Basic Rules:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Use complete descriptive information that accurately describes variables, fields, classes, interfaces, etc."),(0,r.kt)("li",{parentName:"ul"},"Use mixed case (except special characters) to improve the readability of the name."),(0,r.kt)("li",{parentName:"ul"},"Use terminology within the blockchain industry."),(0,r.kt)("li",{parentName:"ul"},"Use as few abbreviations as possible. If you must use them, it is recommended to use public abbreviations and custom abbreviations."),(0,r.kt)("li",{parentName:"ul"},"Avoid using names that are similar or just distinguish between upper and lower case."),(0,r.kt)("li",{parentName:"ul"},"The directory uses lowercase uniformly, without special symbols."),(0,r.kt)("li",{parentName:"ul"},"For smart contracts, the file name is consistent with the contract name."),(0,r.kt)("li",{parentName:"ul"},"The naming suggestion is to use the hump name uniformly.")),(0,r.kt)("h4",{id:"document-format-for-smart-contracts"},"Document Format For Smart Contracts"),(0,r.kt)("p",null,"File Layout Rules:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Generally more than 1000 lines of program code is difficult to read, try to avoid the situation that the number of lines of code in a file is too long. Each contract document should contain only a single contract class or contract interface.")),(0,r.kt)("p",null,"Order Of Files:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Notes on files: All contract source files have a note at the beginning, which lists the copyright statement, file name, function description, and creation and modification records of the file."),(0,r.kt)("li",{parentName:"ul"},"File/Package reference: In the contract source file, the first non-comment line is the compiler version, followed by the reference statement."),(0,r.kt)("li",{parentName:"ul"},"Remarks for class or interface: Comments should be made before class and interface definitions, including descriptions of classes and interfaces, latest modifiers, version numbers, reference links, etc."),(0,r.kt)("li",{parentName:"ul"},"The order of member variables: first the public level, then the protection level, and finally the private level."),(0,r.kt)("li",{parentName:"ul"},"Functions: Functions within a contract should be grouped by module, not by scope or access permissions.")),(0,r.kt)("h4",{id:"suggestions"},"Suggestions"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"In the smart contract, to get the value of the state variable modified by the public, there is no need to write a function of ",(0,r.kt)("inlineCode",{parentName:"li"},"get"),"."),(0,r.kt)("li",{parentName:"ul"},"In a smart contract, if an anonymous function modified by payable is added to the contract, the contract address can accept ATP transfers.")),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"contract-security-development-guide"},"Contract Security Development Guide"),(0,r.kt)("p",null,"In Solidity, you can use smart contracts to handle tokens or, possibly, even more valuable things. Furthermore, every execution of a smart contract happens in public and, in addition to that, the source code is often available. In the blockchain world, contracts have always been the main point of attack for hackers, and they have also caused very large losses. Therefore, the security development of the contract is very important. You can consider the following aspects to improve the security of the contract."),(0,r.kt)("h3",{id:"compiler-bug"},"Compiler Bug"),(0,r.kt)("p",null,"First, you must understand the bugs of the Solidity compiler itself, and try to avoid the version of the compiler in question or the use of the problem. Solidity compiler bug list: ",(0,r.kt)("a",{parentName:"p",href:"https://solidity.readthedocs.io/en/latest/bugs.html"},"https://solidity.readthedocs.io/en/latest/bugs.html"),"."),(0,r.kt)("h3",{id:"standard-contract-development-process"},"Standard Contract Development Process"),(0,r.kt)("p",null,"If you want to solve the security problem of smart contracts, you must develop contracts according to standard processes."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"The detailed design must be completed first, taking into account various scenarios and abnormal situations. Avoid unclear and incompletely introduced bugs."),(0,r.kt)("li",{parentName:"ol"},"During development, to be modular and concise, complexity will increase the risk of errors."),(0,r.kt)("li",{parentName:"ol"},"Before the contract is deployed to the mainnet, the contract must be adequately reviewed and tested."),(0,r.kt)("li",{parentName:"ol"},"Keep an eye on the operation status of the contract. In an emergency, you can destroy the contract or provide a similar emergency freeze function.")),(0,r.kt)("h3",{id:"common-pitfalls"},"Common Pitfalls"),(0,r.kt)("h4",{id:"private-information-and-randomness"},"Private Information and Randomness"),(0,r.kt)("p",null,"Everything you use in a smart contract is publicly visible, even local variables and state variables marked ",(0,r.kt)("inlineCode",{parentName:"p"},"private"),"."),(0,r.kt)("p",null,"Using random numbers in smart contracts is quite tricky if you do not want miners to be able to cheat(The use of random numbers in smart contracts is difficult to ensure that nodes do not cheat. This is because random numbers in smart contracts generally rely on the local time of the computing node, and local time can be forged by malicious nodes. Therefore, this method is not safe. A common practice is to use off-chain third-party services such as Oraclize to obtain random numbers)."),(0,r.kt)("h4",{id:"re-entrancy"},"Re-Entrancy"),(0,r.kt)("p",null,"Any interaction from a contract (A) with another contract (B) and any transfer of Ether hands over control to that contract (B). This makes it possible for B to call back into A before this interaction is completed. To give an example, the following code contains a bug (it is just a snippet and not a complete contract):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"pragma solidity >=0.4.0 <0.7.0;\n\n// THIS CONTRACT CONTAINS A BUG - DO NOT USE\ncontract Fund {\n    /// Mapping of ether shares of the contract.\n    mapping(address => uint) shares;\n    /// Withdraw your share.\n    function withdraw() public {\n        if (msg.sender.send(shares[msg.sender]))\n            shares[msg.sender] = 0;\n    }\n}\n")),(0,r.kt)("p",null,"The problem is not too serious here because of the limited gas as part of ",(0,r.kt)("inlineCode",{parentName:"p"},"send"),", but it still exposes a weakness: Ether transfer can always include code execution, so the recipient could be a contract that calls back into ",(0,r.kt)("inlineCode",{parentName:"p"},"withdraw"),". This would let it get multiple refunds and basically retrieve all the Ether in the contract. In particular, the following contract will allow an attacker to refund multiple times as it uses ",(0,r.kt)("inlineCode",{parentName:"p"},"call")," which forwards all remaining gas by default:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'pragma solidity >=0.4.0 <0.7.0;\n\n// THIS CONTRACT CONTAINS A BUG - DO NOT USE\ncontract Fund {\n    /// Mapping of ether shares of the contract.\n    mapping(address => uint) shares;\n    /// Withdraw your share.\n    function withdraw() public {\n        (bool success,) = msg.sender.call.value(shares[msg.sender])("");\n        if (success)\n            shares[msg.sender] = 0;\n    }\n}\n')),(0,r.kt)("p",null,"To avoid re-entrancy, you can use the Checks-Effects-Interactions pattern as outlined further below:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"pragma solidity >=0.4.11 <0.7.0;\n\ncontract Fund {\n    /// Mapping of ether shares of the contract.\n    mapping(address => uint) shares;\n    /// Withdraw your share.\n    function withdraw() public {\n        uint share = shares[msg.sender];\n        shares[msg.sender] = 0;\n        msg.sender.transfer(share);\n    }\n}\n")),(0,r.kt)("p",null,"Note that re-entrancy is not only an effect of Ether transfer but of any function call on another contract. Furthermore, you also have to take multi-contract situations into account. A called contract could modify the state of another contract you depend on."),(0,r.kt)("h4",{id:"gas-limit-and-loops"},"Gas Limit and Loops"),(0,r.kt)("p",null,"Loops that do not have a fixed number of iterations, for example, loops that depend on storage values, have to be used carefully: Due to the block gas limit, transactions can only consume a certain amount of gas. Either explicitly or just due to normal operation, the number of iterations in a loop can grow beyond the block gas limit which can cause the complete contract to be stalled at a certain point. This may not apply to ",(0,r.kt)("inlineCode",{parentName:"p"},"view")," functions that are only executed to read data from the blockchain. Still, such functions may be called by other contracts as part of on-chain operations and stall those. Please be explicit about such cases in the documentation of your contracts."),(0,r.kt)("h4",{id:"sending-and-receiving-ether"},"Sending and Receiving Ether"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Neither contracts nor \u201cexternal accounts\u201d are currently able to prevent that someone sends them Ether. Contracts can react on and reject a regular transfer, but there are ways to move Ether without creating a message call. One way is to simply \u201cmine to\u201d the contract address and the second way is using ",(0,r.kt)("inlineCode",{parentName:"li"},"selfdestruct(x)"),"."),(0,r.kt)("li",{parentName:"ul"},"If a contract receives Ether (without a function being called), either the receive Ether or the fallback function is executed. If it does not have a receive nor a fallback function, the Ether will be rejected (by throwing an exception). During the execution of one of these functions, the contract can only rely on the \u201cgas stipend\u201d it is passed (2300 gas) being available to it at that time. This stipend is not enough to modify storage (do not take this for granted though, the stipend might change with future hard forks). To be sure that your contract can receive Ether in that way, check the gas requirements of the receive and fallback functions."),(0,r.kt)("li",{parentName:"ul"},"There is a way to forward more gas to the receiving contract using ",(0,r.kt)("inlineCode",{parentName:"li"},'addr.call{value: x}("")'),". This is essentially the same as ",(0,r.kt)("inlineCode",{parentName:"li"},"addr.transfer(x)"),", only that it forwards all remaining gas and opens up the ability for the recipient to perform more expensive actions (and it returns a failure code instead of automatically propagating the error). This might include calling back into the sending contract or other state changes you might not have thought of. So it allows for great flexibility for honest users but also for malicious actors."),(0,r.kt)("li",{parentName:"ul"},"Use the most precise units to represent the wei amount as possible, as you lose any that is rounded due to a lack of precision."),(0,r.kt)("li",{parentName:"ul"},"If you want to send Ether using ",(0,r.kt)("inlineCode",{parentName:"li"},"address.transfer"),", there are certain details to be aware of:",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"If the recipient is a contract, it causes its receive or fallback function to be executed which can, in turn, call back the sending contract."),(0,r.kt)("li",{parentName:"ol"},"Sending Ether can fail due to the call depth going above 1024. Since the caller is in total control of the call depth, they can force the transfer to fail; take this possibility into account or use ",(0,r.kt)("inlineCode",{parentName:"li"},"send")," and make sure to always check its return value. Better yet, write your contract using a pattern where the recipient can withdraw Ether instead."),(0,r.kt)("li",{parentName:"ol"},"Sending Ether can also fail because the execution of the recipient contract requires more than the allotted amount of gas (explicitly by using ",(0,r.kt)("inlineCode",{parentName:"li"},"require"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"assert"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"revert")," or because the operation is too expensive) - it \u201cruns out of gas\u201d (OOG). If you use ",(0,r.kt)("inlineCode",{parentName:"li"},"transfer")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"send")," with a return value check, this might provide a means for the recipient to block progress in the sending contract. Again, the best practice here is to use a ",(0,r.kt)("a",{parentName:"li",href:"https://solidity.readthedocs.io/en/latest/common-patterns.html#withdrawal-pattern"},"\u201cwithdraw\u201d pattern instead of a \u201csend\u201d pattern"),"\u3002")))),(0,r.kt)("h4",{id:"callstack-depth"},"Callstack Depth"),(0,r.kt)("p",null,"External function calls can fail any time because they exceed the maximum call stack of 1024. In such situations, Solidity throws an exception. Malicious actors might be able to force the call stack to a high value before they interact with your contract."),(0,r.kt)("p",null,"Note that ",(0,r.kt)("inlineCode",{parentName:"p"},".send()")," does ",(0,r.kt)("strong",{parentName:"p"},"not")," throw an exception if the call stack is depleted but rather returns ",(0,r.kt)("inlineCode",{parentName:"p"},"false")," in that case. The low-level functions ",(0,r.kt)("inlineCode",{parentName:"p"},".call()"),", ",(0,r.kt)("inlineCode",{parentName:"p"},".delegatecall()")," and ",(0,r.kt)("inlineCode",{parentName:"p"},".staticcall()")," behave in the same way."),(0,r.kt)("h4",{id:"txorigin"},"tx.origin"),(0,r.kt)("p",null,"Never use tx.origin for authorization. Let\u2019s say you have a wallet contract like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"pragma solidity >=0.5.0 <0.7.0;\n\n// THIS CONTRACT CONTAINS A BUG - DO NOT USE\ncontract TxUserWallet {\n    address owner;\n\n    constructor() public {\n        owner = msg.sender;\n    }\n\n    function transferTo(address payable dest, uint amount) public {\n        require(tx.origin == owner);\n        dest.transfer(amount);\n    }\n}\n")),(0,r.kt)("p",null,"Now someone tricks you into sending Ether to the address of this attack wallet:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"pragma solidity >=0.5.0 <0.7.0;\n\ninterface TxUserWallet {\n    function transferTo(address payable dest, uint amount) external;\n}\n\ncontract TxAttackWallet {\n    address payable owner;\n\n    constructor() public {\n        owner = msg.sender;\n    }\n\n    function() external {\n        TxUserWallet(msg.sender).transferTo(owner, msg.sender.balance);\n    }\n}\n")),(0,r.kt)("p",null,"If your wallet had checked ",(0,r.kt)("inlineCode",{parentName:"p"},"msg.sender")," for authorization, it would get the address of the attack wallet, instead of the owner address. But by checking ",(0,r.kt)("inlineCode",{parentName:"p"},"tx.origin"),", it gets the original address that kicked off the transaction, which is still the owner address. The attack wallet instantly drains all your funds."),(0,r.kt)("h4",{id:"twos-complement--underflows--overflows"},"Two\u2019s Complement / Underflows / Overflows"),(0,r.kt)("p",null,"As in many programming languages, Solidity\u2019s integer types are not actually integers. They resemble integers when the values are small, but behave differently if the numbers are larger. For example, the following is true: ",(0,r.kt)("inlineCode",{parentName:"p"},"uint8(255) + uint8(1) == 0"),". This situation is called an ",(0,r.kt)("em",{parentName:"p"},"overflow"),". It occurs when an operation is performed that requires a fixed size variable to store a number (or piece of data) that is outside the range of the variable\u2019s data type. An ",(0,r.kt)("em",{parentName:"p"},"underflow")," is the converse situation: ",(0,r.kt)("inlineCode",{parentName:"p"},"uint8(0) - uint8(1) == 255"),"."),(0,r.kt)("p",null,"In general, read about the limits of two\u2019s complement representation, which even has some more special edge cases for signed numbers."),(0,r.kt)("p",null,"Try to use ",(0,r.kt)("inlineCode",{parentName:"p"},"require")," to limit the size of inputs to a reasonable range and use the ",(0,r.kt)("a",{parentName:"p",href:"https://solidity.readthedocs.io/en/latest/layout-of-source-files.html#smt-checker"},"SMT checker")," to find potential overflows, or use a library like ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/OpenZeppelin/openzeppelin-solidity/blob/master/contracts/math/SafeMath.sol"},"SafeMath")," if you want all overflows to cause a revert."),(0,r.kt)("p",null,"Code such as ",(0,r.kt)("inlineCode",{parentName:"p"},"require((balanceOf[_to] + _value) >= balanceOf[_to])")," can also help you check if values are what you expect."),(0,r.kt)("h4",{id:"clearing-mappings"},"Clearing Mappings"),(0,r.kt)("p",null,"The Solidity type ",(0,r.kt)("inlineCode",{parentName:"p"},"mapping")," (see ",(0,r.kt)("a",{parentName:"p",href:"https://solidity.readthedocs.io/en/latest/types.html#mapping-types"},"Mapping Types"),") is a storage-only key-value data structure that does not keep track of the keys that were assigned a non-zero value. Because of that, cleaning a mapping without extra information about the written keys is not possible. If a ",(0,r.kt)("inlineCode",{parentName:"p"},"mapping")," is used as the base type of a dynamic storage array, deleting or popping the array will have no effect over the ",(0,r.kt)("inlineCode",{parentName:"p"},"mapping")," elements. The same happens, for example, if a ",(0,r.kt)("inlineCode",{parentName:"p"},"mapping")," is used as the type of a member field of a ",(0,r.kt)("inlineCode",{parentName:"p"},"struct")," that is the base type of a dynamic storage array. The ",(0,r.kt)("inlineCode",{parentName:"p"},"mapping")," is also ignored in assignments of structs or arrays that containing a ",(0,r.kt)("inlineCode",{parentName:"p"},"mapping"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"pragma solidity >=0.5.0 <0.7.0;\n\ncontract Map {\n    mapping (uint => uint)[] array;\n\n    function allocate(uint _newMaps) public {\n        for (uint i = 0; i < _newMaps; i++)\n            array.push();\n    }\n\n    function writeMap(uint _map, uint _key, uint _value) public {\n        array[_map][_key] = _value;\n    }\n\n    function readMap(uint _map, uint _key) public view returns (uint) {\n        return array[_map][_key];\n    }\n\n    function eraseMaps() public {\n        delete array;\n    }\n}\n")),(0,r.kt)("p",null,"Consider the example above and the following sequence of calls: ",(0,r.kt)("inlineCode",{parentName:"p"},"allocate(10)"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"writeMap(4, 128, 256)"),". At this point, calling ",(0,r.kt)("inlineCode",{parentName:"p"},"readMap(4, 128)")," returns 256. If we call ",(0,r.kt)("inlineCode",{parentName:"p"},"eraseMaps"),", the length of state variable ",(0,r.kt)("inlineCode",{parentName:"p"},"array")," is zeroed, but since its ",(0,r.kt)("inlineCode",{parentName:"p"},"mapping")," elements cannot be zeroed, their information stays alive in the contract\u2019s storage. After deleting ",(0,r.kt)("inlineCode",{parentName:"p"},"array"),", calling ",(0,r.kt)("inlineCode",{parentName:"p"},"allocate(5)")," allows us to access ",(0,r.kt)("inlineCode",{parentName:"p"},"array[4]")," again, and calling ",(0,r.kt)("inlineCode",{parentName:"p"},"readMap(4, 128)")," returns 256 even without another call to ",(0,r.kt)("inlineCode",{parentName:"p"},"writeMap"),"."),(0,r.kt)("p",null,"If your ",(0,r.kt)("inlineCode",{parentName:"p"},"mapping")," information must be deleted, consider using a library similar to ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/ethereum/dapp-bin/blob/master/library/iterable_mapping.sol"},"iterable mapping"),", which allows you to traverse the keys and delete their values in the appropriate ",(0,r.kt)("inlineCode",{parentName:"p"},"mapping"),"."),(0,r.kt)("h4",{id:"permission-control-error"},"Permission Control Error"),(0,r.kt)("p",null,"In smart contracts, contract developers usually set some permission for the contract owner, but if the developer negligently writes wrong function permissions, it may lead to serious consequences such as transfer of the owner."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"function initContract() public {\n    owner = msg.reader;\n}\n")),(0,r.kt)("p",null,"The above code function needs to be set onlyOwner."),(0,r.kt)("p",null,"Reasonable permissions should be set for different functions in the contract."),(0,r.kt)("h4",{id:"address-initialization-problem"},"Address Initialization Problem"),(0,r.kt)("p",null,"In EVM, all address-related initializations are given an initial value of 0."),(0,r.kt)("p",null,"If an address variable is equal to 0, the variable may not be initialized or an unknown error may occur."),(0,r.kt)("p",null,"If the developer initializes an address variable in the code but does not assign an initial value, or the user does not assign the address variable by mistake when initiating an operation, but this variable needs to be handled in the following code, it is possible Cause unnecessary security risks."),(0,r.kt)("p",null,"For functions that involve addresses, it is recommended to add require (_to! = Address (0)) verification to effectively avoid unnecessary losses caused by user misoperations or unknown errors."),(0,r.kt)("h4",{id:"transaction-order-dependent"},"Transaction Order Dependent"),(0,r.kt)("p",null,"Since transactions are first stored in mempool in a short period of time, it is possible to know what action will take place before miners package them into blocks. This is troublesome for a decentralized market, because the transaction information of the token can be viewed, and the transaction order can be changed before it is packaged into a block. Avoiding this is difficult because it comes down to the specific contract itself."),(0,r.kt)("p",null,"For example, in the market, it is best to implement batch auctions (this also prevents high frequency trading issues). Another method is using a pre-commit scheme."),(0,r.kt)("h4",{id:"minor-details"},"Minor Details"),(0,r.kt)("p",null,"Types that do not occupy the full 32 bytes might contain \u201cdirty higher order bits\u201d. This is especially important if you access ",(0,r.kt)("inlineCode",{parentName:"p"},"msg.data")," - it poses a malleability risk: You can craft transactions that call a function ",(0,r.kt)("inlineCode",{parentName:"p"},"f(uint8 x)")," with a raw byte argument of ",(0,r.kt)("inlineCode",{parentName:"p"},"0xff000001")," and with ",(0,r.kt)("inlineCode",{parentName:"p"},"0x00000001"),". Both are fed to the contract and both will look like the number ",(0,r.kt)("inlineCode",{parentName:"p"},"1")," as far as ",(0,r.kt)("inlineCode",{parentName:"p"},"x")," is concerned, but ",(0,r.kt)("inlineCode",{parentName:"p"},"msg.data")," will be different, so if you use ",(0,r.kt)("inlineCode",{parentName:"p"},"keccak256(msg.data)")," for anything, you will get different results."),(0,r.kt)("h3",{id:"security-recommendations"},"Security Recommendations"),(0,r.kt)("h4",{id:"take-warnings-seriously"},"Take Warnings Seriously"),(0,r.kt)("p",null,"If the compiler warns you about something, you should better change it. Even if you do not think that this particular warning has security implications, there might be another issue buried beneath it. Any compiler warning we issue can be silenced by slight changes to the code."),(0,r.kt)("p",null,"Always use the latest version of the compiler to be notified about all recently introduced warnings."),(0,r.kt)("h4",{id:"restrict-the-amount-of-ether"},"Restrict the Amount of Ether"),(0,r.kt)("p",null,"Restrict the amount of Ether (or other tokens) that can be stored in a smart contract. If your source code, the compiler or the platform has a bug, these funds may be lost. If you want to limit your loss, limit the amount of Ether."),(0,r.kt)("h4",{id:"simple-and-modular"},"Simple and Modular"),(0,r.kt)("p",null,"Keep your contracts small and easily understandable. Single out unrelated functionality in other contracts or into libraries. General recommendations about source code quality of course apply: Limit the amount of local variables, the length of functions and so on. Document your functions so that others can see what your intention was and whether it is different than what the code does."),(0,r.kt)("h4",{id:"use-the-checks-effects-interactions-pattern"},"Use the Checks-Effects-Interactions Pattern"),(0,r.kt)("p",null,"Most functions will first perform some checks (who called the function, are the arguments in range, did they send enough Ether, does the person have tokens, etc.). These checks should be done first."),(0,r.kt)("p",null,"As the second step, if all checks passed, effects to the state variables of the current contract should be made. Interaction with other contracts should be the very last step in any function."),(0,r.kt)("p",null,"Early contracts delayed some effects and waited for external function calls to return in a non-error state. This is often a serious mistake because of the re-entrancy problem explained above."),(0,r.kt)("p",null,"Note that, also, calls to known contracts might in turn cause calls to unknown contracts, so it is probably better to just always apply this pattern."),(0,r.kt)("h4",{id:"include-a-fail-safe-mode"},"Include a Fail-Safe Mode"),(0,r.kt)("p",null,"While making your system fully decentralised will remove any intermediary, it might be a good idea, especially for new code, to include some kind of fail-safe mechanism:"),(0,r.kt)("p",null,"You can add a function in your smart contract that performs some self-checks like \u201cHas any Ether leaked?\u201d, \u201cIs the sum of the tokens equal to the balance of the contract?\u201d or similar things. Keep in mind that you cannot use too much gas for that, so help through off-chain computations might be needed there."),(0,r.kt)("p",null,"If the self-check fails, the contract automatically switches into some kind of \u201cfailsafe\u201d mode, which, for example, disables most of the features, hands over control to a fixed and trusted third party or just converts the contract into a simple \u201cgive me back my money\u201d contract."),(0,r.kt)("h4",{id:"check-function-permissions-carefully"},"Check Function Permissions Carefully"),(0,r.kt)("p",null,"Reasonable permissions should be set for different functions in the contract."),(0,r.kt)("p",null,"Check whether the functions in the contract use public and private keywords for visibility modification. Check whether the contract is correctly defined and uses modifiers to restrict access to key functions to avoid problems caused by unauthorized use."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"function initContract() public OnlyOwner {\n    owner = msg.reader;\n}\n")),(0,r.kt)("h4",{id:"ask-for-peer-review"},"Ask for Peer Review"),(0,r.kt)("p",null,"The more people examine a piece of code, the more issues are found. Asking people to review your code also helps as a cross-check to find out whether your code is easy to understand - a very important criterion for good smart contracts."),(0,r.kt)("h4",{id:"other"},"Other"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/guylando/KnowledgeLists/blob/master/EthereumSmartContracts.md"},"More Security Recommendations ")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"https://consensys.github.io/smart-contract-best-practices/"},"Contract Best Practices"))),(0,r.kt)("h3",{id:"security-tools"},"Security Tools"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Ethereum formal verification tool ",(0,r.kt)("a",{parentName:"li",href:"https://solidity.readthedocs.io/en/latest/layout-of-source-files.html#smt-checker"},"SMT checker")," ."),(0,r.kt)("li",{parentName:"ol"},"Formal verification tools: ",(0,r.kt)("a",{parentName:"li",href:"https://marketplace.visualstudio.com/items?itemName=Beosin.beosin-vaas-eth"},"offline VS Code plugin"),"\uff0cand ",(0,r.kt)("a",{parentName:"li",href:"https://beosin.com/vaas/index.html#/audit/ptsj"},"Online version")," ."),(0,r.kt)("li",{parentName:"ol"},"Remix integrated security scan plugin: ",(0,r.kt)("a",{parentName:"li",href:"https://docs.mythx.io/en/latest/"},"MythX"),"\u3002")),(0,r.kt)("h3",{id:"third-party-audit"},"Third Party Audit"),(0,r.kt)("p",null,"You can find a professional third-party audit company for security audits, such as\uff1a",(0,r.kt)("a",{parentName:"p",href:"https://www.slowmist.com/en/service-smart-contract-security-audit.html"},"slow mist"),"\u3002"),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"faq"},"FAQ"),(0,r.kt)("h3",{id:"about-compile"},"About Compile"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"How many commands in alaya-truffle\uff1f"),(0,r.kt)("p",{parentName:"li"},"Refer to  alaya-truffle develop guide ",(0,r.kt)("a",{parentName:"p",href:"https://platon-truffle.readthedocs.io/en/alaya/"},"Reference here"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Why contract syntax cannot be verified?"),(0,r.kt)("p",{parentName:"li"},"Solidity 0.4.x has a great different with 0.5.x, detail info refer to ",(0,r.kt)("a",{parentName:"p",href:"https://solidity.readthedocs.io/en/develop/"},"Reference here"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Why truffle doesn't compile?"),(0,r.kt)("p",{parentName:"li"},"Confirm the contract version same as the version specified in the truffle-config.js.\nContract syntax be writed in a wrong way.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Why the contract can not be deployed by truffle migrate?"),(0,r.kt)("p",{parentName:"li"},"Confrim the blockchain network info be configured correctly.\nConfirm the account address be configured correctly.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Deploying a contract with a parameter constructor using the command ",(0,r.kt)("inlineCode",{parentName:"p"},"truffle migrate")," failed."),(0,r.kt)("p",{parentName:"li"},"For example, A.sol "),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"Constructor(uint256 a, string memory b, string memory c) public {}\n")),(0,r.kt)("p",{parentName:"li"},"2_initial_A.js configured as follow\uff1a"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"const A = artifacts.require(\"A\");  \nmodule.exports = function(deployer) {\n        deployer.deploy(A,100,'PLA','PLAT');//pass the corresponding construction parameters\n};\n")))))}d.isMDXComponent=!0}}]);